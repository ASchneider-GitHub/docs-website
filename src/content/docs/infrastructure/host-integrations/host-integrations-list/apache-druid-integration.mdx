---
title: Apache Druid integration
tags:
  - Druid integration
  - apache druid integration
  - New Relic integrations
metaDescription: Use New Relic infrastructure agent to get a dashboard with druid metrics.
---
import infrastructureDruidDashboard from 'images/infrastructure_screenshot-full_apache-druid-dashboard.webp'

Integrating Apache Druid with New Relic enhances your ability to monitor, analyze, and optimize the performance of your Druid clusters. By leveraging New Relic's powerful monitoring and alerting features, you can ensure the reliability and efficiency of your Druid-based analytics platform.

<img
    title="Apache Druid dashboard"
    alt="Apache Druid dashboard"
    src={infrastructureDruidDashboard}
/>

<figcaption>
After you set up our Druid integration, we give you a dashboard for your Druid metrics.
</figcaption>

## Expose Druid metrics using prometheus emitter [#Expose]
1. Navigate to the `_common` directory:
```shell
cd apache-druid-24.0.0/conf/druid/single-server/micro-quickstart/_common
```
2. Below command is used to open the `common.runtime.properties` file:
```shell
sudo nano common.runtime.properties
```
3. Locate the extensions load list. Append `prometheus.emitter` to the end of the list as shown below for reference:
```shell
druid.extensions.loadList=["druid-hdfs-storage", "druid-kafka-indexing-service", "druid-datasketches", "druid-multi-stage-query", "prometheus-emitter"]
```
4. In the `Broker`, `Coordinator-Overlord`, `Historical`, `MiddleManager`, and `Router` folders, open the `runtime.properties` file and paste the following snippet at the end of each:
```shell
# Monitoring
druid.monitoring.monitors=["org.apache.druid.java.util.metrics.JvmMonitor"]
druid.emitter=prometheus
druid.emitter.logging.logLevel=info
druid.emitter.prometheus.strategy=exporter
druid.emitter.prometheus.port=19092
```

## Installing the Prometheus Emitter Extension [#prometheus-emitter-extension]
1. Use the following command to create a folder named `prometheus-emitter` within the `extensions` folder directory of your Apache Druid setup:
```shell
cd apache-druid-29.0.0/extensions/
```
```shell
sudo mkdir prometheus-emitter
```
2. Navigate to the druid download directory. To run below command to create jar files that will be called when the server starts up:
```shell
java \
  -cp "lib/*" \
  -Ddruid.extensions.directory="extensions" \
  -Ddruid.extensions.hadoopDependenciesDir="hadoop-dependencies" \
  org.apache.druid.cli.Main tools pull-deps \
  --no-default-hadoop \
  -c "org.apache.druid.extensions.contrib:prometheus-emitter:24.0.0"
```

## Install the infrastructure agent [#infra]

To get data into New Relic, install our infrastructure agent. Our infrastructure agent collects and ingests data so you can keep track of your Druid performance.

You can install the infrastructure agent two different ways:

* Our [guided install](https://one.newrelic.com/nr1-core?state=4f81feab-35f7-e97e-9903-52510f8542bd) is a CLI tool that inspects your system and installs the infrastructure agent alongside the application monitoring agent that best works for your system. To learn more about how our guided install works, check out our [Guided install overview](/docs/infrastructure/host-integrations/installation/new-relic-guided-install-overview).
* If you'd rather install our infrastructure agent manually, you can follow a tutorial for manual installation for [Linux](/docs/infrastructure/install-infrastructure-agent/linux-installation/install-infrastructure-monitoring-agent-linux), [Windows](/docs/infrastructure/install-infrastructure-agent/windows-installation/install-infrastructure-monitoring-agent-windows/).

## Configure `nri-prometheus` for Apache Druid [#configure]
1. Create a file named `nri-prometheus-config.yml` in this path:
```shell
/etc/newrelic-infra/integrations.d
```

2. Add a snippet to your `nri-prometheus-config.yml` file that enables the agent to capture Druid data. Your configuration file should match our snippet in the [nri-prometheus](https://github.com/newrelic/nri-prometheus/blob/main/configs/nri-prometheus-config.yml.sample) repository:
```yml
integrations:
  - name: nri-prometheus
    config:
      # When standalone is set to false nri-prometheus requires an infrastructure agent to work and send data. Defaults to true
      standalone: false

      # When running with infrastructure agent emitters will have to include infra-sdk
      emitters: infra-sdk

      # The name of your cluster. It's important to match other New Relic products to relate the data.
      cluster_name: "prometheus-druid"

      targets:
        - description: Secure etcd example
          urls: ["https://<localhost>:19092"]
      #    tls_config:
      #      ca_file_path: "/etc/etcd/etcd-client-ca.crt"
      #      cert_file_path: "/etc/etcd/etcd-client.crt"
      #      key_file_path: "/etc/etcd/etcd-client.key"

      # Whether the integration should run in verbose mode or not. Defaults to false.
      verbose: false

      # Whether the integration should run in audit mode or not. Defaults to false.
      # Audit mode logs the uncompressed data sent to New Relic. Use this to log all data sent.
      # It does not include verbose mode. This can lead to a high log volume, use with care.
      audit: false

      # The HTTP client timeout when fetching data from endpoints. Defaults to "5s" if it is not set.
      # This timeout in seconds is passed as well as a X-Prometheus-Scrape-Timeout-Seconds header to the exporters
      # scrape_timeout: "5s"

      # Length in time to distribute the scraping from the endpoints. Default to "30s" if it is not set.
      scrape_duration: "5s"
      # Number of worker threads used for scraping targets.
      # For large clusters with many (>400) endpoints, slowly increase until scrape
      # time falls between the desired `scrape_duration`.
      # Increasing this value too much will result in huge memory consumption if too
      # many metrics are being scraped.
      # Default: 4
      # worker_threads: 4

      # Whether the integration should skip TLS verification or not. Defaults to false.
      insecure_skip_verify: false

    timeout: 10s
```

## Forward Druid logs to New Relic [#Forward-log]

You can use our [log forwarding](https://docs.newrelic.com/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/) to forward Druid logs to New Relic.
1. On Linux machines, your log file named `logging.yml` should be present in this path:
```shell
/etc/newrelic-infra/logging.d/
```
2. Add the following script to the `logging.yml` file:
```yml
- name: druid-logs
  file: /home/<Druid-Download Directory>/log/*.log
  attributes:
     logtype: apache-druid
```

## Restart the infrastructure agent [#restart-infra]

Before you can start reading your data, use the instructions in our [infrastructure agent docs](https://docs.newrelic.com/docs/infrastructure/install-infrastructure-agent/manage-your-agent/start-stop-restart-infrastructure-agent/) to restart your infrastructure agent.
```shell
sudo systemctl restart newrelic-infra.service
```

## View your Druid metrics in New Relic [#view-data]

Once you've completed the setup above, you can view your metrics using our pre-built dashboard template named apache-druid. To access this dashboard:

1. Go to **[one.newrelic.com](https://one.newrelic.com/) > + Add data**.
2.  Click on the **Dashboards** tab.
3.  In the search box, type `Apache-druid`.
4.  Select it and click **Install**.

To instrument the Apache Druid quickstart and to see metrics and alerts, you can also follow our [Apache Druid quickstart page](https://newrelic.com/instant-observability/apache-druid) by clicking on the `Install now` button.

Here are some example queries:

<DoNotTranslate>**Example:**</DoNotTranslate> check the Avg Druid Segment Size
```sql
SELECT average(druid_segment_size) AS  'MiB' FROM Metric SINCE 30 MINUTES AGO
```

## What's next? [#whats-next]

To learn more about building NRQL queries and generating dashboards, check out these docs:

* [Introduction to the query builder](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder) to create basic and advanced queries.
* [Introduction to dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards) to customize your dashboard and carry out different actions.
* [Manage your dashboard](/docs/query-your-data/explore-query-data/dashboards/manage-your-dashboard) to adjust your <InlinePopover type="dashboards" /> display mode, or to add more content to your dashboard.
