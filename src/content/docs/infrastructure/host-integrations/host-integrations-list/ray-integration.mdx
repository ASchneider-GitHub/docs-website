---
title: Ray integration
tags:
   - Ray integration
   - New Relic integrations
metaDescription: Install our Ray dashboards and see your ray data in New Relic.
freshnessValidatedDate: never
---

import infrastructureRayDashboard from 'images/infrastructure_screenshot-full_ray-dashboard.webp'

Our Ray integration monitors the performance of your Ray, helping you diagnose and optimize the Ray clusters, ML tasks such as data preprocessing, distributed training, hyperparameter tuning, reinforcement learning, and model serving and scaling Python applications.Our Ray integration makes use of our infrastructure agent and NRI-Prometheus gives you a pre-built dashboard with your most important Ray metrics.

<img
    src={infrastructureRayDashboard}
    title="Ray dashboard"
    alt="Ray dashboard"
/>

<figcaption>
After setting up the integration with New Relic, see your data in dashboards like these, right out of the box.
</figcaption>

## Install the infrastructure agent [#infrastructure]

To get data into New Relic, install our infrastructure agent. Our infrastructure agent collects and ingests data so you can keep track of your Ray performance.

You can install the infrastructure agent two different ways:

* Our [guided install](https://one.newrelic.com/nr1-core?state=4f81feab-35f7-e97e-9903-52510f8542bd) is a CLI tool that inspects your system and installs the infrastructure agent alongside the application monitoring agent that best works for your system. To learn more about how our guided install works, check out our [Guided install overview](/docs/infrastructure/host-integrations/installation/new-relic-guided-install-overview). 

* If you’d rather install our infrastructure agent manually, you can follow a tutorial for manual installation for [Linux](/docs/infrastructure/install-infrastructure-agent/linux-installation/install-infrastructure-monitoring-agent-linux), [Windows](/docs/infrastructure/install-infrastructure-agent/windows-installation/install-infrastructure-monitoring-agent-windows/), or [macOS](/docs/infrastructure/install-infrastructure-agent/macos-installation/install-infrastructure-monitoring-agent-macos/).

## Install the Prometheus
1. Visit the [Prometheus download page](https://prometheus.io/download/) to find the latest release.
2. Select the appropriate version for your operating system and architecture. For Linux, you'll likely choose the linux-amd64 version. Copy the download link for the tarball (`.tar.gz` file).
3. Once Prometheus is downloaded, untar the download tar file:
```shell
tar -xvzf <filename.tar.gz>
```
4. Navigate to the untar downloaded Prometheus folder and run the below command to start the prometheus:
```shell
cd /DOWNLOADED-FOLDER/
```
```shell
./prometheus --config.file=/tmp/ray/session_latest/metrics/prometheus/prometheus.yml
```

5. When Prometheus starts, it operates on port 9090. Navigate to the Prometheus web interface, select 'Status' and click on the desired target to view the Ray metrics endpoint URLs, as shown below:
`
http://YOUR_DOMAIN:64415/metrics, http://YOUR_DOMAIN:44217/metrics, http://YOUR_DOMAIN:44227/metrics
`

## Configure `nri-prometheus` for Ray [#configure]
1. Create a file named `nri-prometheus-config.yml` in this path:
```shell
/etc/newrelic-infra/integrations.d
```

2. Add a snippet to your `nri-prometheus-config.yml` file that enables the agent to capture Druid data. Your configuration file should match our snippet in the [nri-prometheus](https://github.com/newrelic/nri-prometheus/blob/main/configs/nri-prometheus-config.yml.sample) repository:
```yml
integrations:
  - name: nri-prometheus
    config:
      standalone: false
      # Defaults to true. When standalone is set to `false`, `nri-prometheus` requires an infrastructure agent to send data.
      emitters: infra-sdk
      # When running with infrastructure agent emitters will have to include infra-sdk
      cluster_name: Ray_Metrics
      # Match the name of your cluster with the name seen in New Relic. 
      targets:
        - description: Ray_Metrics
          urls: ["http://<YOUR_HOST_IP>:64747/metrics", "http://<YOUR_HOST_IP>:44217/metrics", "http://<YOUR_HOST_IP>:44227/metrics"]
      #    tls_config:
      #      ca_file_path: "/etc/etcd/etcd-client-ca.crt"
      #      cert_file_path: "/etc/etcd/etcd-client.crt"
      #      key_file_path: "/etc/etcd/etcd-client.key"
      verbose: false
      # Defaults to false. This determines whether or not the integration should run in verbose mode.
      audit: false
      # Defaults to false and does not include verbose mode. Audit mode logs the uncompressed data sent to New Relic and can lead to a high log volume.
      # scrape_timeout: "YOUR_TIMEOUT_DURATION"
      # `scrape_timeout` is not a mandatory configuration and defaults to 30s. The HTTP client timeout when fetching data from endpoints.
      scrape_duration: "5s"
      # worker_threads: 4
      # `worker_threads` is not a mandatory configuration and defaults to `4` for clusters with more than 400 endpoints. Slowly increase the worker thread until scrape time falls between the desired `scrape_duration`. Note: Increasing this value too much results in huge memory consumption if too many metrics are scraped at once.
      insecure_skip_verify: false
      # Defaults to false. Determins if the integration should skip TLS verification or not.
    timeout: 10s
```

## Forward Ray logs to New Relic [#Forward-log]
You can use our [log forwarding](https://docs.newrelic.com/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/) to forward Druid logs to New Relic.
1. On Linux machines, your log file named `logging.yml` should be present in this path:
```shell
/etc/newrelic-infra/logging.d/
```
2. Add the following script to the `logging.yml` file:
```yml
- name: dashboard.log
  file: /tmp/ray/session_latest/logs/dashboard.log
  attributes:
    logtype: ray_dashboard_logs
- name: monitor.log
  file: /tmp/ray/session_latest/logs/monitor.log
  attributes:
    logtype: ray_monitor_logs
- name: log_monitor.log
  file: /tmp/ray/session_latest/logs/log_monitor.log
  attributes:
    logtype: ray_log_monitor_logs
```

## Restart the infrastructure agent [#restart-infra]

Before you can start reading your data, use the instructions in our [infrastructure agent docs](https://docs.newrelic.com/docs/infrastructure/install-infrastructure-agent/manage-your-agent/start-stop-restart-infrastructure-agent/) to restart your infrastructure agent.
```shell
sudo systemctl restart newrelic-infra.service
```

## View your Ray metrics in New Relic [#view-data]

Once you've completed the setup above, you can view your metrics using our pre-built dashboard template named Ray. To access this dashboard:

1. Go to **[one.newrelic.com](https://one.newrelic.com/) > + Add data**.
2.  Click on the **Dashboards** tab.
3.  In the search box, type `Ray`.
4.  When you see our pre-build dashboard, click on it to install it in your account.

To instrument the Ray quickstart and to see metrics and alerts, you can also follow our [Ray  quickstart page](https://newrelic.com/instant-observability/ray) by clicking on the “Install now” button.

Example Query:

<DoNotTranslate>**Example:**</DoNotTranslate> check the ray cluster active nodes
```sql
SELECT latest(ray_cluster_active_nodes) FROM Metric
```

## What's next?

To learn more about building NRQL queries and generating dashboards, check out these docs:

* [Introduction to the query builder](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder) to create basic and advanced queries.
* [Introduction to dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards) to customize your dashboard and carry out different actions.
* [Manage your dashboard](/docs/query-your-data/explore-query-data/dashboards/manage-your-dashboard) to adjust your dashboards display mode, or to add more content to your dashboard.