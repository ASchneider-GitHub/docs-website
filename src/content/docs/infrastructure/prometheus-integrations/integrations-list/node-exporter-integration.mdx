---
title: 'Node Exporter integration'
tags:
  - Integrations
  - Node Exporter 
  - Prometheus
  - host monitoring 
freshnessValidatedDate: 2024-04-10 
---

Do you want to monitor hardware and kernel metrics for a Linux server? You can do this with the New Relic remote write integration and the Prometheus Node Exporter. When you combine these two programs with the Prometheus monitoring system, you can send data to New Relic where you can analyze it. 

## Prerequisites [#prerequisites]

Our instructions here are based on the Prometheus guide [Monitoring Linux host metrics with the node exporter](https://prometheus.io/docs/guides/node-exporter/). We'll expand on those instructions with steps to help you send your data to New Relic.

Here's what you need to get started:

* Decide which Linux host you want to instrument. We'll show examples below for Linux servers in EC2, GCP, and Azure instances.
* Make sure you've installed the Prometheus monitoring system. If you haven't already, you can find download it from the [Prometheus site](https://prometheus.io/download/). 

## Download and start Node Exporter [#download-node-exporter] 

Complete the following:

1. Download and start Node Exporter with the commands below. Be sure to replace the `wget` URL with the latest from the Prometheus [downloads](https://prometheus.io/download#node_exporter) page:

    ```bash
    # Note that <VERSION>, <OS>, and <ARCH> are placeholders.
    wget https://github.com/prometheus/node_exporter/releases/download/v<VERSION>/node_exporter-<VERSION>.<OS>-<ARCH>.tar.gz
    tar xvfz node_exporter-*.*-amd64.tar.gz
    cd node_exporter-*.*-amd64
    ./node_exporter
    ```
2. Set Node Exporter to run in the background with the keyboard commands `CONTROL + z` and `bg`.

## Configurations [#configs]

Before you start Prometheus, you'll need to make some changes in your main `prometheus.yml` configuration file.

### Connect Prometheus to New Relic [#add-url-and-license]

Open `prometheus.yml` in a text editor, and insert the `remote_write` snippet below. Keep the following in mind:

* This is a snippet for Prometheus v2.26 and higher. If you're using an older version, see our main [remote write instructions](/docs/infrastructure/prometheus-integrations/install-configure-remote-write/set-your-prometheus-remote-write-integration/#setup). 
* Make sure to replace `YOUR_LICENSE_KEY` with your value. 
* Insert this snippet under `global_config` at the same indentation level as the `global` section.

```yml
remote_write:
  - url: https://metric-api.newrelic.com/prometheus/v1/write?prometheus_server=NodeExporter
    authorization:
      credentials: YOUR_LICENSE_KEY
```

### Set up targets [#set-up-targets]

You can configure targets statically via the `static_configs` parameter, or you can use dynamic discovery with one of the supported service-discovery mechanisms.  

#### EC2 [#service-discovery-ec2]

You can configure service discovery for your AWS EC2 instances by supplying the `region`, `access_key`, `secret_key` and `port` like this:

```yml
    # Service Discovery or static configs
    ec2_sd_configs:
      - region: <EC2_REGION>
        # The AWS API keys. If blank, the environment variables `AWS_ACCESS_KEY_ID`
        # and `AWS_SECRET_ACCESS_KEY` are used.
        access_key: <ACCESS_KEY>
        secret_key: <SECRET_KEY>
        # The port to scrape metrics from. If using the public IP address, this must
        # instead be specified in the relabeling rule.
        # By default node_exporter will expose metrics on 9100
        port: <PORT>
```

Or, you can set up a static configuration:

```yml
    # Service Discovery or static configs
    static_configs:
    - targets: ['localhost:9100']
```

#### Azure [#service-discovery-azure] 

You can configure service discovery for your Azure instances like this:

```yml
- job_name: node
    azure_sd_config:
      # The subscription ID. Always required.
      subscription_id: <SUBSCRIPTION_ID>
```

Or, you can set up a static configuration: 

```yml
    # Service Discovery or static configs
    static_configs:
    - targets: ['localhost:9100']
```

#### GCP [#service-discovery-gcp]

You can configure service discovery for your GCP instances like this:

```yml
- job_name: node
    gce_sd_config:
      # The GCP Project
      project: <PROJECT>
```
Or, you can set up a static configuration: 

```yml
    # Service Discovery or static configs
    static_configs:
    - targets: ['localhost:9100']
```

### Set up the host to APM relationship [#host-to-apm]

To enable relationship features in New Relic for your host and the applications they run, you need to include some additional configuration options. Relationships require attributes that are dropped by default in Prometheus. To get around this, you can include them through the `relabel_configs` step in the config file.

The `source_label` specified under `relabel_configs` differs based on the provider you're using: 

* EC2: `__meta_ec2_instance_id`
* Azure: `__meta_azure_machine_id` 
* GCP: `__meta_gce_instance_id` 

You can find all the available meta attributes under the appropriate `sd_config` in the Prometheus [Configuration](https://prometheus.io/docs/prometheus/latest/configuration/configuration) page.

Here are some examples of `relabel_configs`:

[EC2](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#ec2_sd_config)

```yml
- job_name: node
    ec2_sd_configs:
      - region: <EC2_REGION>
        # The AWS API keys. If blank, the environment variables `AWS_ACCESS_KEY_ID`
        # and `AWS_SECRET_ACCESS_KEY` are used.
        access_key: <ACCESS_KEY>
        secret_key: <SECRET_KEY>
        # The port to scrape metrics from. If using the public IP address, this must
        # instead be specified in the relabeling rule.
        # By default node_exporter will expose metrics on 9100
        port: <PORT>
    # Relabel configs
    relabel_configs:
      - source_labels: [__meta_ec2_instance_id]
        target_label: instanceid
```

[Azure](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#azure_sd_config)

```yml
- job_name: node
    azure_sd_config:
      # The subscription ID. Always required.
      subscription_id: <SUBSCRIPTION_ID>
    relabel_configs:
      - source_labels: [__meta_azure_machine_id]
        target_label: instanceid
```

[GCP](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#gce_sd_config)

```yml
- job_name: node
    gce_sd_config:
      # The GCP Project
      project: <PROJECT>
    relabel_configs:
      - source_labels: [__meta_gce_instance_id]
        target_label: instanceid
```

## Start Prometheus [#prometheus-startup]

Now you can start the Prometheus scraper.

1. Execute the following:

    ```
    ./prometheus --config.file=./prometheus.yml
    ```
3. Set the scraper to run in the background with the keyboard commands `CONTROL + z` and `bg`. 
2. See your data in the New Relic UI by going to **<DoNotTranslate>[one.newrelic.com](https://one.newrelic.com/)</DoNotTranslate> &gt; Infrastructure &gt; Hosts**. 