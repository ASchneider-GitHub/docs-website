---
title: Monitor Amazon ECS environments with APM language agents
tags:
  - APM Agents
  - Elastic Container Service
  - Fargate
metaDescription: New Relic's APM agents can be setup to monitor your Amazon ECS environment.
redirects:

freshnessValidatedDate: never
---
New Relic's language agents can be installed and configured to monitor your [Amazon ECS](https://docs.aws.amazon.com/ecs/index.html) environment and produce APM data and metrics via Docker instrumentation.


## Installing the agent into your Docker container [#installing-the-agent]

To add the agent into your Docker container, follow the installation steps specific to the language agent you are using:
     * [Java](https://docs.newrelic.com/docs/apm/agents/java-agent/additional-installation/install-new-relic-java-agent-docker/)
     * [.NET](https://docs.newrelic.com/install/dotnet/?deployment=linux&docker=yesDocker)
     * [Node.js](https://docs.newrelic.com/docs/apm/agents/nodejs-agent/installation-configuration/install-nodejs-agent-docker/)
     * [Python](https://docs.newrelic.com/install/python/)


## Setting up the agent in your ECS task definition [#agent-task-def]

In order to get the agent running in your ECS environment, you will need to make modifications to your [task defintion file](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definitions.html).
The task definition file allows you to specify parameters you would like for your application to run with. For agent setup, the following environment variables will need to be defined:

 <Tabs>
      <TabsBar>
        <TabsBarItem id="java">
          Java
        </TabsBarItem>

        <TabsBarItem id="dotnet">
          .NET
        </TabsBarItem>

        <TabsBarItem id="nodejs">
          Node.js
        </TabsBarItem>

        <TabsBarItem id="python">
          Python
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="java">
          ```task-definition
            "environment": [
                # Specify your region-aware host here
                {
                    "name": "NEW_RELIC_HOST",
                    "value": "collector.newrelic.com"
                },
                # App name is required
                {
                    "name": "NEW_RELIC_APP_NAME",
                    "value": "Fargate Demo (AWS)"
                },
                # License key is required
                {
                    "name": "NEW_RELIC_LICENSE_KEY",
                    "value": "your-license-key"
                }
            ],
          ```
        </TabsPageItem>

        <TabsPageItem id="dotnet">
          ```task-definition
            "environment": [
                # Specify your region-aware host here
                {
                    "name": "NEW_RELIC_HOST",
                    "value": "collector.newrelic.com"
                },
                # Setting an app name is highly recommended but not required
                {
                    "name": "NEW_RELIC_APP_NAME",
                    "value": "Fargate Demo (AWS)"
                },
                # License key is required
                {
                    "name": "NEW_RELIC_LICENSE_KEY",
                    "value": "your-license-key"
                }
            ],
          ```
        </TabsPageItem>

        <TabsPageItem id="nodejs">
          ```task-definition
            "environment": [
                # Specify your region-aware host here
                {
                    "name": "NEW_RELIC_HOST",
                    "value": "collector.newrelic.com"
                },
                # App name is required
                {
                    "name": "NEW_RELIC_APP_NAME",
                    "value": "Fargate Demo (AWS)"
                },
                # License key is required
                {
                    "name": "NEW_RELIC_LICENSE_KEY",
                    "value": "your-license-key"
                }
            ],
          ```
        </TabsPageItem>

        <TabsPageItem id="python">
          ```task-definition
            "environment": [
                # Specify your region-aware host here
                {
                    "name": "NEW_RELIC_HOST",
                    "value": "collector.newrelic.com"
                },
                # Setting an app name is highly recommended but not required
                {
                    "name": "NEW_RELIC_APP_NAME",
                    "value": "Fargate Demo (AWS)"
                },
                # License key is required
                {
                    "name": "NEW_RELIC_LICENSE_KEY",
                    "value": "your-license-key"
                }
            ],
          ```
        </TabsPageItem>

      </TabsPages>
    </Tabs>

## Setting up the infrastructure agent as a sidecar [#infra-agent-side-car]
You can also set up the New Relic [infrastructure agent](https://docs.newrelic.com/docs/infrastructure/install-infrastructure-agent/get-started/requirements-infrastructure-agent/) as a sidecar in addition to the language agent for more visibility into your environment.
This will provide you with relationship mapping between APM and Infrastructure for features such as the service map and infra-specific metrics.

<img
  title="Screenshot showing service map when running language agent and infra agent together in Fargate environment"
  alt="Service map screenshot running language agent and infra agent together in Fargate environment"
  src="/images/service-map-screenshot-showing-language-and-infra-agent-in-fargate-env.png"
/>

<figcaption>
  This is an example of how the service map would be populated if you run a language agent and the infrastructure agent together in a Fargate environment.
</figcaption>

For more information, please see our [ECS integration install guide](https://docs.newrelic.com/docs/infrastructure/elastic-container-service-integration/install-ecs-integration/).


Example full task definition file:

```json
{
    "family": "nrExampleFargateDef",
    "containerDefinitions": [
        {
            "name": "fargate-test",
            "image": "nrExample/fargate-test:latest",
            "cpu": 256,
            "memoryReservation": 1024,
            "portMappings": [
                {
                    "name": "fargate-test-80-tcp",
                    "containerPort": 80,
                    "hostPort": 80,
                    "protocol": "tcp",
                    "appProtocol": "http"
                }
            ],
            "essential": true,
            "environment": [
                {
                    "name": "NEW_RELIC_HOST",
                    "value": "collector.newrelic.com"
                },
                {
                    "name": "NEW_RELIC_APP_NAME",
                    "value": "Fargate Demo (AWS)"
                },
                {
                    "name": "NEW_RELIC_LICENSE_KEY",
                    "value": "your-license-key"
                }
            ],
            "mountPoints": [],
            "volumesFrom": [],
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "/ecs/nrExampleFargateDef",
                    "awslogs-create-group": "true",
                    "awslogs-region": "us-east-1",
                    "awslogs-stream-prefix": "ecs"
                }
            },
            "systemControls": []
        },
        {
            "name": "newrelic-infra",
            "image": "newrelic/nri-ecs:1.11.10",
            "cpu": 256,
            "memoryReservation": 512,
            "portMappings": [],
            "essential": true,
            "environment": [
                {
                    "name": "NRIA_IS_FORWARD_ONLY",
                    "value": "true"
                },
                {
                    "name": "NRIA_LICENSE_KEY",
                    "value": "your-license-key"
                },
                {
                    "name": "NRIA_VERBOSE",
                    "value": "1"
                },
                {
                    "name": "NRIA_PASSTHROUGH_ENVIRONMENT",
                    "value": "ECS_CONTAINER_METADATA_URI,ECS_CONTAINER_METADATA_URI_V4,FARGATE"
                },
                {
                    "name": "FARGATE",
                    "value": "true"
                },
                {
                    "name": "NRIA_CUSTOM_ATTRIBUTES",
                    "value": "{\"nrDeployMethod\":\"downloadPage\"}"
                },
            ],
            "mountPoints": [],
            "volumesFrom": [],
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "/newrelic-infra/ecs",
                    "awslogs-region": "us-east-1",
                    "awslogs-stream-prefix": "verbose"
                }
            },
            "systemControls": []
        }
    ],
    "taskRoleArn": "arn:aws:iam::111111111111:role/ecsTaskExecutionRole",
    "executionRoleArn": "arn:aws:iam::111111111111:role/ecsTaskExecutionRole",
    "networkMode": "awsvpc",
    "requiresCompatibilities": [
        "FARGATE"
    ],
    "cpu": "1024",
    "memory": "3072",
    "runtimePlatform": {
        "cpuArchitecture": "X86_64",
        "operatingSystemFamily": "LINUX"
    }
}
```

## Next steps after setup [#next-steps]

After you've setup your desired agent(s):

* Wait a few minutes and then [look for your data in the UI](/docs/ecs-integration-understand-use-data).
* Recommended: Install our [ECS cloud integration](/docs/integrations/amazon-integrations/aws-integrations-list/aws-ecsecr-monitoring-integration), which gets you other ECS data, including information about clusters and services.
* See [recommended alert conditions](/docs/ecs-integration-recommended-alert-conditions).
* Consider looking at configuration docs for your language agent:
     * [Java](https://docs.newrelic.com/docs/apm/agents/java-agent/configuration/java-agent-configuration-config-file/)
     * [.NET](https://docs.newrelic.com/docs/apm/agents/net-agent/configuration/net-agent-configuration/)
     * [Node.js](https://docs.newrelic.com/docs/apm/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration/)
     * [Python](https://docs.newrelic.com/docs/apm/agents/python-agent/configuration/python-agent-configuration/)
