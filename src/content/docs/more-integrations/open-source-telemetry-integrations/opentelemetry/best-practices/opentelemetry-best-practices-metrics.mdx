---
title: 'OpenTelemetry metrics in New Relic'
tags:
  - Integrations
  - Open source telemetry integrations
  - OpenTelemetry
metaDescription: Details on how New Relic works with OpenTelemetry metrics
freshnessValidatedDate: never
---

OpenTelemetry provides a dimensional metrics [data model](https://opentelemetry.io/docs/specs/otel/metrics/data-model/), an [API](https://opentelemetry.io/docs/specs/otel/metrics/api/) for recording metric telemetry, and an [SDK](https://opentelemetry.io/docs/specs/otel/metrics/sdk/) for aggregating and exporting metric data.

This page describes how New Relic handles OpenTelemetry metrics it receives via the [New Relic OTLP Endpoint]. Integrating OpenTelemetry metrics with New Relic requires configuring the metric source to export to this endpoint - please review endpoint configuration requirements. For information on configuring services with OpenTelemetry metrics see [OpenTelemetry APM monitoring](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-intro).

## Instrument kind to metric type mapping [#instrument-mapping]

The OpenTelemetry metrics API defines [several instrument kinds](https://opentelemetry.io/docs/specs/otel/metrics/api/#instrument). Instruments record measurements, which are aggregated and exported via OTLP as a particular metric type. The table below describes the default behavior on how each OpenTelemetry instrument aggregates and exports. See [OTLP Metric Mapping](#otlp-mapping) for details on how each metric type is treated in New Relic.

| Instrument Kind              | Example usage                    | Default Aggregation         | Exported Metric Type                    |
|------------------------------|----------------------------------|-----------------------------|-----------------------------------------|
| [counter]                    | Bytes processed                  | [sum]                       | [sum metric], with `is_monotonic=true`  |
| [asynchronous counter]       | Observe total process CPU time   | [sum]                       | [sum metric], with `is_monotonic=true`  |
| [updowncounter]              | Items in a queue                 | [sum]                       | [sum metric], with `is_monotonic=false` |
| [asynchronous updowncounter] | Observe current memory usage     | [sum]                       | [sum metric], with `is_monotonic=false` |
| [histogram]                  | Duration of http requests        | [explicit bucket histogram] | [histogram metric] **[1]**              |
| [gauge]                      | Change events for CPU fan speed  | [last value]                | [gauge metric]                          |
| [asynchronous gauge]         | Observe current room temperature | [last value]                | [gauge metric]                          |

See [OpenTelemetry metrics supplementary guidelines](https://opentelemetry.io/docs/specs/otel/metrics/supplementary-guidelines/) for details on choosing the correct instrument type.

**[1]**: Histogram instruments can also be aggregated to exponential histogram metrics. See [#otlp-histogram] for more details.

## OTLP metric mapping [#otlp-mapping]

New Relic maps OTLP metrics to the [`Metric` data type](https://docs.newrelic.com/docs/data-apis/understand-data/metric-data/metric-data-type/#metric-types). The table below describes how fields from the [Metric proto messages](https://github.com/open-telemetry/opentelemetry-proto/blob/main/opentelemetry/proto/metrics/v1/metrics.proto) are interpreted. See [Instrument kind to metric type](#instrument-mapping) for details on how the various metric types are produced by OpenTelemetry APIs / SDKs.

| OTLP Metric Proto Field                        | New Relic `Metric` field                                                                                             |
|------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|
| `ResourceMetrics.Resource.attributes`          | Each key/value is an attribute on the `Metric`**[1]**                                                                |
| `ScopeMetrics.InstrumentationScope.name `      | `otel.library.name`                                                                                                  |
| `ScopeMetrics.InstrumentationScope.version`    | `otel.library.version`                                                                                               |
| `ScopeMetrics.InstrumentationScope.attributes` | Each key/value is an attribute on the `Metric`**[1]**                                                                |
| `Metric.name`                                  | `metricName`                                                                                                         |
| `Metric.description`                           | `description`                                                                                                        |
| `Metric.unit`                                  | `unit`                                                                                                               |
| `Metric.*.data_points.start_time_unix_nano`    | `timestamp`                                                                                                          |
| `Metric.*.data_points.time_unix_nano`          | `endTimestamp`                                                                                                       |
| `Metric.*.data_points.attributes`              | Each key/value is an attribute on the `Metric`**[1]**                                                                |
| `Metric.gauge.data_points`                     | Maps to New Relic [`gauge`][newrelic metric types]                                                                   |
| `Metric.sum.data_points`                       | Maps to New Relic [`count`, `cumulativeCount`, or `gauge`][newrelic metric types], see [OTLP sum metrics](#otlp-sum) |
| `Metric.histogram.data_points`                 | Maps to New Relic [`distribution`][newrelic metric types], see [OTLP sum metrics](#otlp-histogram)                   |
| `Metric.exponential_histogram.data_points`     | Maps to New Relic [`distribution`][newrelic metric types], see [OTLP histogram metrics](#otlp-histogram)             |
| `Metric.summary.data_points`                   | Maps to New Relic [`summary`][newrelic metric types], see [OTLP summary metrics](#otlp-histogram)                    |

**[1]**: In case of conflict in resource attributes, scope attributes, metric point attributes, and top level metric fields, the order of precedent (highest to lowest) is: top level `Metric.*` fields > `Metric.*.data_points.attributes` > `ScopeMetrics.InstrumentationScope.attributes` > `ResourceMetrics.Resource.attributes`.

[newrelic metric types]: https://docs.newrelic.com/docs/data-apis/understand-data/metric-data/metric-data-type/#metric-types

### OTLP sum metrics [#otlp-sum]

OTLP [sum metrics][sum metric] represent the sum of measurements over time. Sums include an [`aggregation_temporality`](#aggregation-temporality) field and an `is_monotonic` field, which indicates whether the values are monotonically increasing (i.e. can only go up) or not (i.e. can go up and down). The following table describes how New Relic treats different sum varieties:

| `is_monotonic` | `aggregation_temporality` | Behavior                                                                                                                                                                       |
|----------------|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `true`         | `cumulative`              | Maps to New Relic [`cumulativeCount`][newrelic metric types]                                                                                                                   |
| `true`         | `delta`                   | Maps to New Relic [`count`][newrelic metric types]                                                                                                                             |
| `false`        | `cumulative`              | Maps to New Relic [`gauge`][newrelic metric types]                                                                                                                             |
| `false`        | `delta`                   | Not supported since data is not meaningful. See [discussion](https://github.com/open-telemetry/opentelemetry-specification/pull/2314#pullrequestreview-877408961) for details. |

### OTLP histogram metrics [#otlp-histogram]

OTLP [histogram metrics][histogram metric] and [exponential histogram metrics][exponential histogram metric] summarize a population of measurements with information like sum, count, min, max, and buckets describing the distribution of measurement values. The histogram variety (also called explicit bucket histogram) has buckets with explicit boundaries. The exponential variety has buckets with boundaries described by an exponential formula. Both varieties include an [aggregation temporality](#aggregation-temporality) field.

Both varieties of histograms are translated to New Relic [`distribution`][newrelic metric types], which is backed by an internal base 2 exponential histogram representation. This representation closely mirrors the OpenTelemetry exponential histogram format. For this reason, New Relic prefers exponential histogram (see [details](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/best-practices/opentelemetry-otlp/#metric-mistogram-aggregation) on configuring OTLP to prefer exponential histograms). The OpenTelemetry explicit bucket histogram variety is translated to the exponential representation using linear interpolation. See [NrSketch](https://github.com/newrelic-experimental/newrelic-sketch-java#new-relic-sketch) for a detailed explanation.

Buckets with boundaries at negative and positive infinity are represented in New Relic as zero-width buckets. For example, an OpenTelemetry bucket with bounds `[-∞, 10)` is represneted in New Relic as `[10, 10)`. As a result, you may see exagerated bucket counts at the ends of your distribution.

### OTLP summary metrics [#otlp-summary]

OTLP [summary metrics][summary metric] are similar to histograms in that they summarize a population of measurements, including sum and count. However, where histograms include buckets to describe the distribution of measurements, summaries include quantiles. These quantiles are of limited use since they cannot undergo spatial or temporal reaggregation. Summaries included in OpenTelemetry for legacy support, and OpenTelemetry APIs and SDK do not produce summaries.

Summaries are translated to New Relic [`summary`][newrelic metric types].

## Aggregation temporality [#aggregation-temporality]

The OpenTelemetry notion of [aggregation temporality](https://opentelemetry.io/docs/specs/otel/metrics/data-model/#temporality) defines whether a particular metric data point aggregates a cumulative set of measurements (typically since application start) or the delta set of measurements since last export. OTLP [sum metrics](#otlp-sum) and [histogram metrics](#otlp-histogram) have an `aggregation_temporality` field which describes the semantics of their points.

Although we accept both cumulative and delta temporality metrics, New Relic is generally a delta metrics system, and users are encouraged to [configure their OTLP exporter to prefer delta temporality](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/best-practices/opentelemetry-otlp/#metric-aggregation-temporality).

When temporality is cumulative, metrics are converted to a delta representation (with the cumulative value retained for [`cumulativeCount`][newrelic metric types]), using a stateful translation is a stateful process in which compute the delta from two consecutive cumulative cumulative points of the same series. The `Metric.*.data_points.start_time_unix_nano` is used to detect series resets.

## Exemplars [#exemplars]

OpenTelemetry metric [exemplars](https://opentelemetry.io/docs/specs/otel/metrics/data-model/#exemplars) are not currently supported by New Relic.

[New Relic OTLP endpoint]: /docs/more-integrations/open-source-telemetry-integrations/opentelemetry/best-practices/opentelemetry-otlp

[counter]: https://opentelemetry.io/docs/specs/otel/metrics/api/#counter
[asynchronous counter]: https://opentelemetry.io/docs/specs/otel/metrics/api/#asynchronous-counter
[updowncounter]: https://opentelemetry.io/docs/specs/otel/metrics/api/#updowncounter
[asynchronous updowncounter]: https://opentelemetry.io/docs/specs/otel/metrics/api/#asynchronous-updowncounter
[histogram]: https://opentelemetry.io/docs/specs/otel/metrics/api/#histogram
[gauge]: https://opentelemetry.io/docs/specs/otel/metrics/api/#gauge
[asynchronous gauge]: https://opentelemetry.io/docs/specs/otel/metrics/api/#asynchronous-gauge

[sum]: https://opentelemetry.io/docs/specs/otel/metrics/sdk/#sum-aggregation
[explicit bucket histogram]: https://opentelemetry.io/docs/specs/otel/metrics/sdk/#explicit-bucket-histogram-aggregation
[last value]: https://opentelemetry.io/docs/specs/otel/metrics/sdk/#last-value-aggregation

[sum metric]: https://github.com/open-telemetry/opentelemetry-proto/blob/a05597bff803d3d9405fcdd1e1fb1f42bed4eb7a/opentelemetry/proto/metrics/v1/metrics.proto#L217-L226
[histogram metric]: https://github.com/open-telemetry/opentelemetry-proto/blob/a05597bff803d3d9405fcdd1e1fb1f42bed4eb7a/opentelemetry/proto/metrics/v1/metrics.proto#L230-L236
[exponential histogram metric]: https://github.com/open-telemetry/opentelemetry-proto/blob/a05597bff803d3d9405fcdd1e1fb1f42bed4eb7a/opentelemetry/proto/metrics/v1/metrics.proto#L240-L246
[gauge metric]: https://github.com/open-telemetry/opentelemetry-proto/blob/a05597bff803d3d9405fcdd1e1fb1f42bed4eb7a/opentelemetry/proto/metrics/v1/metrics.proto#L211-L213
[summary metric]: https://github.com/open-telemetry/opentelemetry-proto/blob/a05597bff803d3d9405fcdd1e1fb1f42bed4eb7a/opentelemetry/proto/metrics/v1/metrics.proto#L254-L256
