---
title: Monitor Airflow with OpenTelemetry and New Relic 
tags:
  - Integrations
  - Open source telemetry integrations
  - OpenTelemetry
  - Airflow
  - Quickstart
metaDescription: Here is a simple example to setup Airflow OpenTelemetry metrics to send data to New Relic.
redirects:
  - /docs/more-integrations/open-source-telemetry-integrations/opentelemetry/airflow/monitoring-airflow-ot
---

import opentelemetryOpentelemetryAirflow04 from 'images/opentelemetry_screenshot-full_opentelemetry-jenkins-04.webp'

import opentelemetryAirflow05 from 'images/opentelemetry_screenshot-full_jenkins-05.webp'

Monitor Airflow with [OpenTelemetry Metrics](https://airflow.apache.org/docs/apache-airflow/stable/administration-and-deployment/logging-monitoring/metrics.html#setup-opentelemetry) by visualizing tasks, operators, and DAG executions as metrics. You can also install the [quickstart](https://newrelic.com/instant-observability/amazon-mwaa) to get a pre-built dashboard to monitor your Airflow pipeline.

<img
  title="Screenshot showing sample Airflow dashboard in New Relic"
  alt="Screenshot showing sample Airflow dashboard in New Relic"
  src={opentelemetryAirflow05}
/>

## Prerequisites [#prerequisites]

You need to first install the Airflow package with OpenTelemetry using the `otel` extra. This can be done in one of several ways, depending on how you deploy Airflow:

### Installing from PyPi [#install-pypi]

1. Follow the installation instructions from [Airflow's Documentation](https://airflow.apache.org/docs/apache-airflow/stable/installation/installing-from-pypi.html).
2. When installing with pip, add the `otel` extra to the command.
  a. eg. `pip install "apache-airflow[otel]"`

### Installing from Docker [#install-docker]

1. Setup the [Airflow Docker image](https://airflow.apache.org/docs/docker-stack/index.html) using instructions from [Airflow's Documentation](https://airflow.apache.org/docs/docker-stack/index.html).
2. Extend the prebuilt image by using a Dockerfile to install the `otel` extra. You can replace the latest tag with your desired version of the Airflow image.

```
FROM apache/airflow:latest
RUN pip install --no-cache-dir "apache-airflow[otel]==${AIRFLOW_VERSION}"
```

## Configuration [#configuration]

You need to configure the Airflow OpenTelemetry metrics to send data to an [OpenTelemetry Collector](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/collector/opentelemetry-collector-intro/) that reports data to a New Relic [OTLP Endpoint](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/opentelemetry-setup/#note-endpoints) using a <InlinePopover type="licenseKey" />.

<Callout variant="important">
  Airflow does not currently supporting sending OpenTelemetry data with authentication headers, making the OpenTelemetry Collector a requirement to authenticate with New Relic.
</Callout>

### OpenTelemetry Collector Configuration [#configuration-collector]

1. Follow the [basic collector example](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/collector/opentelemetry-collector-basic/) to setup your OpenTelemetry Collector.
2. Configure it with your appropriate OTLP Endpoint. For example, `https://otlp.nr-data.net:4317`.
3. For authentication, add your <InlinePopover type="licenseKey" /> as an environment variable so it populates the `api-key` header.
4. Ensure port 4318 on the collector is open and available to the running Airflow instance. (For docker, you may need to use a [docker network](https://docs.docker.com/network/).)
5. Launch your collector.

### Airflow Metrics Configuration [#configuration-airflow]

Airflow sends metrics using OTLP over HTTP. To send this data to our OpenTelemetry Collector it will need to be sent to port 4318. Airflow has multiple methods of [setting configuration options](https://airflow.apache.org/docs/apache-airflow/stable/howto/set-config.html).

<Callout variant="important">
  If your environment has Airflow running in a docker container alongside the OpenTelemetry Collector, you will need to change the `otel_host` setting from `localhost` to the container address of the collector.
</Callout>

Choose one of the following methods to set the required options for Airflow.

1. Set the required options in the `airflow.cfg` file.

```
[metrics]
otel_on = True
otel_host = localhost
otel_port = 4318
otel_ssl_active = False
```

2. Or, set the required options as environment variables.

```
export AIRFLOW__METRICS__OTEL_ON=True
export AIRFLOW__METRICS__OTEL_HOST=localhost
export AIRFLOW__METRICS__OTEL_PORT=4318
export AIRFLOW__METRICS__OTEL_SSL_ACTIVE=False
```

<Callout variant="tip">
  Airflow has [additional settings](https://airflow.apache.org/docs/apache-airflow/stable/administration-and-deployment/logging-monitoring/metrics.html#setup-opentelemetry) for metrics that may be useful. This includes the ability to [rename metrics](https://airflow.apache.org/docs/apache-airflow/stable/administration-and-deployment/logging-monitoring/metrics.html#rename-metrics) before sending, which is helpful if metric names exceed the 63 byte limit for OpenTelemetry.
</Callout>

## Validation [#validation]

Run a DAG or pipeline to see Airflow data in New Relic.

1. Log into Airflow and click **New Item**.
2. Enter an item name, click **Pipeline**, and then **OK**.
3. Scroll down to the very bottom to the **Pipeline** section.
4. Use the Pipeline script, and select an option from the **try sample Pipeline...** dropdown.
5. Click Save.
6. In the newly created pipeline, click **Build Now**.
7. Got to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > APM & services > Services - OpenTelemetry > airflow**.
8. Click **Distributed tracing** to visualize jobs and pipeline executions.
9. Click **Logs** to see your Airflow console logs. If there are no logs, check to make sure the environment variable `OTEL_LOGS_EXPORTER="otlp"` is set.

<img
  title="Screenshot showing Airflow OpenTelemetry plugin"
  alt="Screenshot showing Airflow OpenTelemetry plugin"
  src={opentelemetryOpentelemetryAirflow04}
/>

## Install the Airflow quickstart dashboard [#quickstart]

After you've sent your Airflow pipeline data to New Relic, you can also easily monitor your pipeline executions with the prebuilt dashboard from [New Relic Instant Observability](http://newrelic.com/instant-observability). Get started in minutes with a pre-built dashboard to see key metrics in a consolidated view:

1. Go to the Airflow quickstart in [New Relic Instant Observability](https://newrelic.com/instant-observability/amazon-mwaa), and click **+ Install now**.
2. Select an account and click **Begin installation**.
3. If you've already completed the [validation](#validation), select **done** to move onto the next step.
4. The quickstart deploys the resources to your account. Click **see your data** to get to the dashboard.

<img
  title="Airflow quickstart dashboard in New Relic"
  alt="Airflow quickstart dashboard in New Relic"
  src={opentelemetryAirflow05}
/>

<Callout variant="important">
  Airflow's OpenTelemetry metrics are not maintained by New Relic, so if you have any issues with the instrumentation, [create a new issue in Airflow's GitHub repo](https://github.com/apache/airflow/issues).
</Callout>

<InstallFeedback />
