---
title: "Install and configure Lambda monitoring on New Relic"
metaDescription: Configure your AWS Lambda functions with New Relic 
freshnessValidatedDate: never

---


## Before you begin [#begin]

* If you haven't done so, you may want to check that your Lambda function meets our [compatibility and requirements](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/compatibility-requirement-lambda-monitoring).


## Install Lambda monitoring [#setup]

Lambda monitoring includes:

* An AWS integration to ingest CloudWatch metrics and perform entity synthesis within New Relic.
* A New Relic agent operating in "serverless" mode, included in our [New Relic Lambda Layers](https://github.com/newrelic/newrelic-lambda-layers) or [in your deployment](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/enable-serverless-monitoring-aws-lambda-layerless/).
* A method of sending "instrumented" payloads and optionally logs to New Relic via our [newrelic-log-ingestion](https://github.com/newrelic/aws-log-ingestion) function or [Extension](https://github.com/newrelic/newrelic-lambda-extension), also included in our [New Relic Lambda Layers](https://github.com/newrelic/newrelic-lambda-layers).

<Steps>
<Step>
## Link your AWS and New Relic accounts [#link]
<Callout variant="tip">
If you instrument your Lambda function using the [newrelic-lambda-cli](https://github.com/newrelic/newrelic-lambda-cli), the linking happens automatically and you can skip this step.
</Callout>

By linking accounts, you're granting New Relic permission to create an inventory of your AWS account and automatically gather CloudWatch metrics for your Lambda functions. 
After you've linked accounts, resources in your AWS account will appear as entities in the [entity explorer](/docs/new-relic-solutions/new-relic-one/core-concepts/new-relic-explorer-view-performance-across-apps-services-hosts/#find). Lambda function entities will be found in the Serverless Functions view.

You can link your AWS and New Relic account by one of the following integration methods.

<Tabs>
  <TabsBar>
    <TabsBarItem id="1">AWS Metric Streams(recommended)</TabsBarItem>
    <TabsBarItem id="2">API Polling</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="1">
    For New Relic to monitor your Lambda functions, you'll need to set up an integration between New Relic and AWS. We recommend using [Metric Streams](/docs/infrastructure/amazon-integrations/connect/aws-metric-stream) to help reduce latency and avoid throttling of our polling requests.
    
    </TabsPageItem>
    <TabsPageItem id="2">
    If you're not using a Metric Streams integration, you can choose to set up an [API Polling](/docs/infrastructure/amazon-integrations/connect/connect-aws-new-relic-infrastructure-monitoring) integration instead. By default, an API Polling integration with the Lambda service enabled will poll every 5 minutes for CloudWatch metrics.

You can use the [newrelic-lambda-cli](https://github.com/newrelic/newrelic-lambda-cli) to set up an API Polling integration, but not a Metric Streams integration.

```sh
newrelic-lambda integrations install --nr-account-id YOUR_NR_ACCOUNT_ID \
--nr-api-key YOUR_NEW_RELIC_USER_KEY
```
    </TabsPageItem>
  </TabsPages>
</Tabs>


One step in the [integrations install command](https://github.com/newrelic/newrelic-lambda-cli?tab=readme-ov-file#aws-lambda-integration) will create a `NEW_RELIC_LICENSE_KEY` secret in [AWS Secrets Manager](https://aws.amazon.com/secrets-manager/) for improved security. This is configurable with a `--disable-license-key-secret` flag, along with other options and flags.
</Step>

<Step>
## Instrument your Lambda function [#instrument]

To instrument your Lambda function, you need to integrate three key components: an agent, a handler wrapper, and an extension. These components are bundled together in the New Relic [Lambda layer](https://github.com/newrelic/newrelic-lambda-layers). If using Lambda layers is not an option for you, you can manually incorporate the agent and handler wrapper into your function.
Based on the requirement of your Lambda function, select one of the following instrumention methods:

* [Instrumentation for containerized Lambda function](/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/containerized-images/): Use this method if your Lambda function runs inside a container. Containers provide a consistent, isolated execution environment for your applications. New Relic provides a pre-built Docker image that includes the New Relic Lambda layer, the New Relic Lambda extension, and the New Relic agent. 

* [Instrumentation for layered Lambda function](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own/): Use this method if your Lambda function is packaged as a Zip file and you can add layers. Layers are a distribution mechanism for libraries, custom runtimes, and other dependencies.

* [Instrumentation for layerless Lambda function](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/enable-serverless-monitoring-aws-lambda-layerless/): Use this method if your Lambda function can't use layers, ensuring quick deployment without the necessity to modify layers.



</Step>

<Step>
## Configure environment variables [#environment]

<Callout variant="tip">
When you instrument New Relic's Lambda layer with the CLI, your environment variables with be configured automatically. You may want to change some of the default settings and configure your Lambda functions with the environment variables that match your monitoring needs.
</Callout>
Irrespective of your runtime, configure the following mandotary environment variables for your Lambda function.







 Choose your runtime to see the available environment variables and our recommendations for default settings.

<CollapserGroup>
<Collapser
    id="go"
    title="Go"
>

<table>
    <thead>
        <tr>
            <th>Environment variable</th>
            <th>Default value</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>`NEW_RELIC_ACCOUNT_ID`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_TRUSTED_ACCOUNT_KEY`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID or parent ID, if it exists</td>
        </tr>
    </tbody>
</table>
</Collapser>

<Collapser
    id="java"
    title="Java OpenTracing"
>
<table>
    <thead>
        <tr>
            <th>Environment variable</th>
            <th>Default value</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>`NEW_RELIC_ACCOUNT_ID`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_TRUSTED_ACCOUNT_KEY`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID or parent ID, if it exists</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LAMBDA_HANDLER`</td>
            <td></td>
            <td></td>
            <td>Used by our [handler wrapper](https://github.com/newrelic/newrelic-lambda-layers/blob/master/java/src/main/java/com/newrelic/java/HandlerWrapper.java) to find your function's actual handler.</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_DISTRIBUTED_TRACING_ENABLED`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>Enable or disable distributed tracing</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_PRIMARY_APPLICATION_ID`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_DEBUG`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>Agent log level</td>
        </tr>
    </tbody>
</table>
</Collapser>

<Collapser
    id="node-js"
    title="Node.js"
>
<table>
    <thead>
        <tr>
            <th>Environment variable</th>
            <th>Default value</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>`NEW_RELIC_ACCOUNT_ID`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_TRUSTED_ACCOUNT_KEY`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID or parent ID, if it exists</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LAMBDA_HANDLER`</td>
            <td></td>
            <td></td>
            <td>Used by our [handler wrapper](https://github.com/newrelic/newrelic-lambda-layers/blob/master/nodejs/index.js) to find your function's actual handler. Not needed if using the [manual wrapping method](https://github.com/newrelic/newrelic-lambda-layers?tab=readme-ov-file#note-on-performance-for-es-module-functions).</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_DISTRIBUTED_TRACING_ENABLED`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>Enable or disable distributed tracing (Java excluded)</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_NO_CONFIG_FILE`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>The Node.js agent uses environment variables in Lambda, so this should be set to `true`</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_APP_NAME`</td>
            <td></td>
            <td></td>
            <td>Should be set but is not used in the New Relic UI. Instead, entity names come from the AWS integration.</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LOG_ENABLED`</td>
            <td>`false`</td>
            <td>`true`,`false`</td>
            <td>Enable or disable agent logging</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LOG_LEVEL`</td>
            <td>`info`</td>
            <td>`fatal`, `error`, `warn`, `info`, `debug`, `trace`</td>
            <td>Agent log level</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LOG`</td>
            <td>`stdout`</td>
            <td>`stdout`</td>
            <td>Agent log path should be stdout for the Node.js agent in serverless mode</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_USE_ESM`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>ESM functions that use async/await and not callbacks</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_NATIVE_METRICS_ENABLED`</td>
            <td>`true`</td>
            <td>`true`, `false`</td>
            <td>Should be set to false to reduce cold start duration. When set to `false` it does not collect VM metrics</td>
        </tr>
    </tbody>
</table>

You can find more environment variables in our [Node.js configuration documentation](/docs/apm/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration/).

</Collapser>

<Collapser
    id="python"
    title="Python"
>
<table>
    <thead>
        <tr>
            <th>Environment variable</th>
            <th>Default value</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>`NEW_RELIC_ACCOUNT_ID`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_TRUSTED_ACCOUNT_KEY`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID or parent ID, if it exists</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_DISTRIBUTED_TRACING_ENABLED`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>Enable or disable distributed tracing (Java excluded)</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LAMBDA_HANDLER`</td>
            <td></td>
            <td></td>
            <td>Used by our [handler wrapper](https://github.com/newrelic/newrelic-lambda-layers/blob/master/python/newrelic_lambda_wrapper.py) to find your function's actual handler.</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_NO_CONFIG_FILE`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>Agent uses environment variables in Lambda so this should be set to true</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_APP_NAME`</td>
            <td></td>
            <td></td>
            <td>Should be set but is not used in the New Relic UI. Instead, entity names come from the AWS integration.</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LOG`</td>
            <td>`stderr`</td>
            <td>`stderr`</td>
            <td>Agent log path should be `stderr `for the Python agent in serverless mode</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LOG_LEVEL`</td>
            <td>`info`</td>
            <td>`critical`, `error`, `warning`, `info`, `debug`</td>
            <td>Agent log level</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_SERVERLESS_MODE_ENABLED`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>This should be set to `true` so the agent will run in serverless mode</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_PACKAGE_REPORTING_ENABLED`</td>
            <td>`true`</td>
            <td>`true`, `false`</td>
            <td>Python agent package reporting should be set to `false` to improve cold start times</td>
        </tr>
    </tbody>
</table>

You can find more environment variables in our [Python configuration documentation](/docs/apm/agents/python-agent/configuration/python-agent-configuration).
</Collapser>

<Collapser
    id="ruby"
    title="Ruby"
>
<table>
    <thead>
        <tr>
            <th>Environment variable</th>
            <th>Default value</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>`NEW_RELIC_ACCOUNT_ID`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_TRUSTED_ACCOUNT_KEY`</td>
            <td></td>
            <td></td>
            <td>Your New Relic account ID or parent ID, if it exists</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_DISTRIBUTED_TRACING_ENABLED`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>Enable or disable distributed tracing</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LAMBDA_HANDLER`</td>
            <td></td>
            <td></td>
            <td>Used by our [handler wrapper](https://github.com/newrelic/newrelic-lambda-layers/blob/master/ruby/newrelic_lambda_wrapper.rb) to find your function's actual handler.</td>
        </tr>
    </tbody>
</table>
</Collapser>

<Collapser id="dotnet" title=".NET">
    <table>
        <thead>
            <tr>
                <th>Environment variable</th>
                <th>Default value</th>
                <th>Options</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>`CORECLR_ENABLE_PROFILING`</td>
                <td>`0`</td>
                <td>`0`, `1`</td>
                <td>Required: This must be set to `1` in order for the .NET agent to instrument your application.</td>
            </tr>
            <tr>
                <td>`CORECLR_PROFILER`</td>
                <td></td>
                <td>`{36032161-FFC0-4B61-B559-F6C5D41BAE5A}`</td>
                <td>Required: This must be set to `{36032161-FFC0-4B61-B559-F6C5D41BAE5A}` in order for the .NET agent
                    to instrument your application.</td>
            </tr>
            <tr>
                <td>`CORECLR_NEWRELIC_HOME`</td>
                <td></td>
                <td>`/opt/lib/newrelic-dotnet-agent`</td>
                <td>Required: This must be set to `/opt/lib/newrelic-dotnet-agent` in order for the .NET agent to
                    instrument your application via our layer.</td>
            </tr>
            <tr>
                <td>`CORECLR_PROFILER_PATH`</td>
                <td></td>
                <td>`/opt/lib/newrelic-dotnet-agent/libNewRelicProfiler.so`</td>
                <td>Required: This must be set to `/opt/lib/newrelic-dotnet-agent/libNewRelicProfiler.so` in order for
                    the .NET agent to instrument your application via our layer.</td>
            </tr>
            <tr>
                <td>`NEW_RELIC_LAMBDA_HANDLER`</td>
                <td>the runtime handler</td>
                <td></td>
                <td>This environment variable is necessary if your runtime handler does not follow the assembly::class::method format. In this format, assembly refers to the DLL file containing your code, class denotes the fully qualified name (including the namespace) of the class with your handler method, and method represents the name of the function handler method itself. It's important to note that this environment variable shares its name with those used by our handler wrappers for different agents. However, unlike those agents, the .NET agent does not require a handler wrapper..</td>
            </tr>
            <tr>
                <td>`NEW_RELIC_APP_NAME`</td>
                <td></td>
                <td></td>
                <td>Should be set but is not used in the New Relic UI. Instead, entity names come from the AWS
                    integration.</td>
            </tr>
            <tr>
                <td>`NEW_RELIC_LOG_ENABLED`</td>
                <td>`1`</td>
                <td>`1`, `0`</td>
                <td>Enable or disable agent logging</td>
            </tr>
            <tr>
                <td>`NEW_RELIC_LOG_CONSOLE`</td>
                <td>`0`</td>
                <td>`1`, `0`</td>
                <td>Must be set to `1` to output logs to CloudWatch</td>
            </tr>
            <tr>
                <td>`NEW_RELIC_LOG_LEVEL`</td>
                <td>`info`</td>
                <td>`info`, `debug`, `finest`</td>
                <td>Agent log level</td>
            </tr>
        </tbody>
    </table>

    You can find more environment variables in our [.NET configuration documentation](/docs/apm/agents/net-agent/configuration/net-agent-configuration/) and [layerless instrumentation](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/enable-serverless-monitoring-aws-lambda-layerless/#dotnet) method.

</Collapser>

<Collapser
    id="extension"
    title="Lambda extension"
>

<table>
    <thead>
        <tr>
            <th>Environment variable</th>
            <th>Default value</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>`NEW_RELIC_LAMBDA_EXTENSION_ENABLED`</td>
            <td>`true`</td>
            <td>`true`, `false` </td>
            <td>Enable or disable the extension</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LICENSE_KEY`</td>
            <td></td>
            <td></td>
            <td>Your New Relic ingest key. This overrides Secrets Manager.</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LICENSE_KEY_SECRET`</td>
            <td>`NEW_RELIC_LICENSE_KEY`</td>
            <td></td>
            <td>Custom secret name in AWS Secrets Manager</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_DATA_COLLECTION_TIMEOUT`</td>
            <td>10s</td>
            <td></td>
            <td>Reduce timeout duration when for `Telemetry client error`</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_EXTENSION_LOGS_ENABLED`</td>
            <td>`true`</td>
            <td>`true`, `false`</td>
            <td>Enable or disable `[NR_EXT]` log lines</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_EXTENSION_LOG_LEVEL`</td>
            <td>`INFO`</td>
            <td>`INFO`, `DEBUG`</td>
            <td>log level for NR_EXT log lines</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_EXTENSION_SEND_FUNCTION_LOGS`</td>
            <td>`false`</td>
            <td>`true`, `false`</td>
            <td>Send function logs</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_LOG_ENDPOINT`</td>
            <td>`https://log-api.newrelic.com/log/v1`</td>
            <td>`https://log-api.newrelic.com/log/v1`, `https://log-api.eu.newrelic.com/log/v1`</td>
            <td>Logs endpoint</td>
        </tr>
        <tr>
            <td>`NEW_RELIC_TELEMETRY_ENDPOINT`</td>
            <td>`https://cloud-collector.newrelic.com/aws/lambda/v1`</td>
            <td>`https://cloud-collector.newrelic.com/aws/lambda/v1`, `https://cloud-collector.eu01.nr-data.net/aws/lambda/v1`</td>
            <td>Telemetry endpoint</td>
        </tr>
    </tbody>
</table>

See more environment variables for the New Relic extension in our [documentation](https://github.com/newrelic/newrelic-lambda-extension/blob/cf86fb53f0bd816e1d09d07f7b5c5ab4841010a0/config/config.go#L41-L55).

</Collapser>
</CollapserGroup>
</Step>

<Step>
## Try our example functions

After you've instrumented New Relic's Lambda layer, we strongly recommend trying out our example functions. These working examples should be used as a starting point for instrumenting your own serverless functions. Using these examples can help you become familiar with the the New Relic Lambda layer, testing the account link, and they can be used as a reference for your own instrumentation. Each example demonstrates adding permissions, runtime-specific techniques for wrapping your handler, managing function log retention in CloudWatch, and more.

While there are many ways to manage and deploy Lambda functions, AWS CloudFormation is the mechanism we use for our examples.

Our examples are published, alongside the New Relic Lambda Extension, in this
[GitHub repository](https://github.com/newrelic/newrelic-lambda-extension). There's one for each Lambda runtime New Relic supports:

* [Node.js](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/node)
* [Python](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/python)
* [Go](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/go)
* [Java](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/java)
* [Ruby](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/ruby)
* [.NET](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/dotnet)


You can also learn how to instrument distributed tracing into a non-trivial serverless application in our [distributed tracing example](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/distributedtracing). It illustrates manual trace propagation for SQS and SNS, two of the more popular services that might invoke Lambda functions, with Node, Python, Ruby and Java functions.

<Callout variant="tip">
    When manually testing, telemetry data can be delayed. We recommend waiting seven seconds before invoking the function again, allowing any buffered telemetry to be delivered.
</Callout>
</Step>
</Steps>




