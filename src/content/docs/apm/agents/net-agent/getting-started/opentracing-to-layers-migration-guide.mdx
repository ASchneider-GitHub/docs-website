---
title: OpenTracing to AWS Lambda layers migration guide
tags:
  - Agents
  - NET agent
  - Migration guides
metaDescription: 'This guide helps New Relic AWS Lambda Agent for .NET users migrate from NewRelic.OpenTracing.AmazonLambda.Tracer to AWS Lambda layers'
freshnessValidatedDate: never
---

This guide outlines the major changes between `NewRelic.OpenTracing.AmazonLambda.Tracer` and using the .NET Agent Lambda layer, different options available when upgrading, and how to migrate successfully to using the .NET Agent Lambda layer.

Main changes include:

* The `NewRelic.OpenTracing.AmazonLambda.Tracer` package conflicts with the .NET Agent AWS Lambda instrumentation and must be removed and changes reverted
* The New Relic .NET Agent will be used to instrument the AWS Lambda function instead of `NewRelic.OpenTracing.AmazonLambda.Tracer`
* A pair of AWS Lambda Layers is now available bundling the .NET Agent and the required New Relic Lambda Extension together
* The instrumentation of the AWS Lambda function is automatic in most cases
* The .NET Agent relies on the New Relic Lambda Extension for sending data to New Relic when instrumenting AWS Lambda functions
* The layer can be configured using the New Relic Lambda CLI tool, a Serverless Framework plugin, or manually
* Metric names and timings will differ since the way the function is instrumented has fundamentally changed
* Any dashboard, alerts, or queries that are based on the old metrics will need to be updated after migrating

## Removing `NewRelic.OpenTracing.AmazonLambda.Tracer` and OpenTracing
The `NewRelic.OpenTracing.AmazonLambda.Tracer` package must be removed before using the .NET Agent and any changes made to your AWS Lambda functions to support it must be undone.

1. When setting up the `NewRelic.OpenTracing.AmazonLambda.Tracer` package, it required creating a new FunctionHandler that called the original FunctionHandler, wrapping it to enable instrumentation.  This should be undone prior to removing the `NewRelic.OpenTracing.AmazonLambda.Tracer` to make the clean up go more smoothly.

2. The .NET Agent does not support using OpenTracing APIs to pass in custom data.  Any changes to your code that relied on OpenTracing APIs, whether directly or via the `NewRelic.OpenTracing.AmazonLambda.Tracer` package, need to be removed or migrated to use .NET Agent APIs.

3. Remove the `NewRelic.OpenTracing.AmazonLambda.Tracer` package from the your project.  Clean up any left over issues related to the removal.

## Selecting a layer installation method
With the `NewRelic.OpenTracing.AmazonLambda.Tracer` package removed, the next step is to select which method will be used to install and configure the .NET AWS Lambda layer. As mentioned above there are primarily three options:
- New Relic Lambda CLI
- New Relic Serverless Framework plugin
- Fully manual install

We recommend picking the either the Lambda CLI or the Serverless Framework plugin due since they take care of most of the configuration for you.  Both have their own dependencies and requirements that will need to taken into consideration, some of which will be outlined in the next section.  Which of those you pick will likely depend on what you are using elsewhere in your environment.  We recommend keeping things simple by using the same approach for all of your AWS Lambda functions.

We have published an entire set of detailed instructions for getting start with AWS Lambda monitoring [here](/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/enable-aws-lambda-monitoring/) that explains all of the steps required to setup AWS Lambda monitoring.

## New Relic Lambda CLI
The Lambda CLI [quickstart](/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/instrument-your-own/#quickstarts) has an example of the command to update your AWS Lambda function to use the .NET Agent layer.  This will automatically detect the runtime of the function and select the appropriate layer.  You can find additional setup options in the [Lambda CLI repo](https://github.com/newrelic/newrelic-lambda-cli?tab=readme-ov-file#recommendations).

## New Relic Serverless Framework plugin
The [Serverless Framework plugin quickstart](/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/instrument-your-own/#serverless) has the steps required to install the plugin and update the Serverless Framework configuration.  You can find additional setup options in the [Serverless Framework plugin repo](https://github.com/newrelic/serverless-newrelic-lambda-layers).

## Fully manual install
While we don't recommend manually instrumenting your AWS Lambda function, we have information on the steps required to do so [here](/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/instrument-your-own/#console).  

* In most cases, the .NET Agent will still automatically instrument your AWS Lambda function and switch to "serverless mode" when manually installed
* The New Relic Lambda Extension is still required
