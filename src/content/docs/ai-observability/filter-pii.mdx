---
title: 'Remove PII with drop filters'
metaDescription: 'Drop filters use regex to filter out personally identifying information before it reaches our databases.'
freshnessValidatedDate: never
---

import apmAimDropFilters from 'images/apm_screenshot-crop_aim-drop-filters.webp'

You can set up AIM to drop sensitive data before New Relic stores it in NRDB. Drop rules apply regex filters to NRQL queries, prompting AIM to drop any personally identifiable information (PII) that matches the filter. For example, let's say a customer asks an AI assistant to retrieve something sensitive like an account ID, IP address, or street address. Rather than store those conversation details in our database, a drop filter ensures that that message is dropped and not replicated in our database. 

<img
    title="Drop filters page"
    alt="A screenshot that shows the drop filter landing page for AIM"
    src={apmAimDropFilters}
/>

<figcaption>
    To find this page, go to **[one.newrelic.com](https://one.newrelic.com) > All capabilities > AI Monitoring > Drop filters**
</figcaption>

## Build your drop filters [#sec-compliance]

AIM captures five types of event data:  

* `LlmChatCompletion`
* `LlmTool`
* `LlmChain events`
* `LlmChatCompletionSummary`
* `LlmChatCompletionMessage`

When you create a drop filter for one kind of PII, you need to update the NRQL query to drop that information for all event types. For example, this is a NRQL query for dropping credit card information when it appears in a completion message:

`SELECT content from LlmChatCompletionMessage WHERE content RLIKE r'.<CARD_REGEX_HERE>`

This drops this information from the event type `LlmChatCompletion`, but not for the other four. You need to apply the drop filter to all five event types to ensure that New Relic recognizes sensitive data and drops it before entering our database. 

* `SELECT messages from LlmCompletion WHERE messages RLIKE r'.<REGEX_HERE>`
* EXAMPLE HERE
* EXAMPLE HERE

## Create drop filters [#create]

Drop filters make it possible to drop PII, but there are some steps you must do to stay fully protected. Read these procedures carefully as you make your first drop rule.

<Steps>
    <Step>

    ## Go to the drop filters page

        Go to **[one.newrelic.com > All Capabilities > AI Monitoring > Drop filters](https://onenr.io/0PoR8KlvYwG)**, then click **Create drop filter**. 

    </Step>
    <Step>
        
    ## Create a drop filter 

    Drop filters use NRQL queries to drop sensitive data. Here are three examples of a NRQL query using regex to locate and drop sensitive data:

        * EXAMPLE
        * EXAMPLE
        * EXAMPLE 

    There's a secion at the end of this procedure with regex samples to get you started with drop filters. 
    
    </Step>
    <Step>
        
    ## Add drop filter to four additional tables

        New Relic stores its data in five different tables. When you create a drop filter to drop one kind of data (say, a birth date), you need to repeat the process four additional times to account for those five tables. 

    </Step>
    <Step>
        
    ## Test your drop filter

    To test your drop filter, ELEPHANT 

    </Step>
</Steps>

## Sample expressions [#regex-ref]

REGEX INTRO HERE 

<CollapserGroup>
  <Collapser
    id="ssn"
    title="US social security number"
  >
    **Expression:**
    ```
    (\d{3}[-\s\.]?\d{2}[-\s\.]?\d{4})
    ```
  </Collapser>

  <Collapser
    id="ccn"
    title="Credit card number"
  >
    **Expression:**
    ```
    ((?:(?:4\d{3})|(?:5[1-5]\d{2})|6(?:011|5[0-9]{2}))(?:-?|\040?)(?:\d{4}(?:-?|\040?)){3}|(?:3[4,7]\d{2})(?:-?|\040?)\d{6}(?:-?|\040?)\d{5})
    ```
  </Collapser>

  <Collapser
    id="dob"
    title="US Date of birth"
  >
    **Expression:**
    ```
    ((?:\d{2})?\d\d(?:\\)?(?:\/)?\d\d(?:\\)?(?:\/)?\d{2}(?:\d{2})?)
    ```
  </Collapser>

  <Collapser
    id="email"
    title="Email address"
  >
    **Expression:**
    ```
    ([a-zA-Z0-9!#$'*+?^_`{|}~.-]+(?:@|%40)(?:[a-zA-Z0-9-]+\.)+[a-zA-Z0-9-]+)
    ```
  </Collapser>

  <Collapser
    id="ipv4"
    title="IP address (ipv4)"
  >
    **Expression:**
    ```
    ^([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$
    ```
  </Collapser>

  <Collapser
    id="usstreetaddress"
    title="US street address"
  >
    **Expression:**
    ```
    /\d{1,}(\s{1}\w{1,})(\s{1}?\w{1,})/g
    ```
  </Collapser>

  <Collapser
    id="usphone"
    title="US phone number"
  >
    **Expression:**
    ```
    (^[\+]?[1]?[\W]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4})
    ```
  </Collapser>

  <Collapser
    id="uspassport"
    title="US passport number"
  >
    **Expression:**
    ```
    ([a-zA-Z]?\d?\d{5,8})
    ```
  </Collapser>

  <Collapser
    id="uknino"
    title="UK national insurance number (NINO)"
  >
    **Expression:**
    ```
    ([a-zA-Z]{2}[-\s]?\d{2}[-\s]?\d{2}[-\s]?\d{2}[-\s]?[a-dA-D])
    ```
  </Collapser>

  <Collapser
    id="spainnid"
    title="Spain National ID (NIE/DNI/NIF)"
  >
    **Expression:**
    ```
    ([a-zA-Z]?[-\s]?\d{7,8}[-\s]?[a-zA-Z])
    ```
  </Collapser>

  <Collapser
    id="indiapanid"
    title="India PAN ID"
  >
    **Expression:**
    ```
    ^([a-zA-Z]){5}([0-9]){4}([a-zA-Z]){1}?$
    ```
  </Collapser>

  <Collapser
    id="indiaaadhaar"
    title="India AADHAAR ID"
  >
    **Expression:**
    ```
    ^([2-9]{1}[0-9]{3}\s\d{4}\s\d{4})$
    ```
  </Collapser>

  <Collapser
    id="caphin"
    title="Canada personal health/social insurance number (PHIN/SIN)"
  >
    **Expression:**
    ```
    (\d{3}[-\s\.]?\d{3}[-\s\.]?\d{3})
    ```
  </Collapser>

  <Collapser
    id="cahcn"
    title="Canada health card number"
  >
    **Expression:**
    ```
    (\d{10})
    ```
  </Collapser>

</CollapserGroup>

## What's next? [#whats-next]

