---
title: 'Remove sensitive data with drop filters'
metaDescription: 'Drop filters use regex to filter out personally identifying information before it reaches our databases.'
freshnessValidatedDate: never
---

import apmAimDropFilters from 'images/apm_screenshot-crop_aim-drop-filters.webp'

Introducing an AI product into your environment can introduce security concerns when end users chat with your AI assistant. Let's say an end user prompts an AI assistant to retrieve their own personal data, like an address or credit card on file. As your AI model gathers context to respond to your end user, it carries the prompt through several events. 

You can set up AI Monitoring to drop sensitive information before it's stored in NRDB. Drop filters apply regex to NRQL queries, which tells AI Monitoring to filter for and drop any sensitive information that matches the query. Even if your AI assistant posts sensitive information to your end user, the details of that conversation wouldn't appear in our database.

<img
    title="Drop filters page"
    alt="A screenshot that shows the drop filter landing page for AIM"
    src={apmAimDropFilters}
/>

<figcaption>
    To find this page, go to **[one.newrelic.com](https://one.newrelic.com) > All capabilities > AI Monitoring > Drop filters**
</figcaption>

## Build your drop filters [#sec-compliance]

An AI assistant's message to an end user can be stored in NRDB under five separate event types:  

* `LlmChatCompletion`
* `LlmTool`
* `LlmChain events`
* `LlmChatCompletionSummary`
* `LlmChatCompletionMessage`

This means that the contents of the message are replicated in five different event processes. For example, if an end user prompts the AI for credit card information, that data will be posted when:

* The message passes through the completion API to the model
* Laymans explanation of LLMTool
* Ibid chain events
* Ibid summary
* Ibid completion message

It's critical that when creating drop rules, you apply that rule to our five different events. 

## Create drop filters [#create]

Read these procedures carefully as you make your first drop rule.

<Steps>
    <Step>

    ## Go to the drop filters page

        Go to **[one.newrelic.com > All Capabilities > AI Monitoring > Drop filters](https://onenr.io/0PoR8KlvYwG)**, then click **Create drop filter**. 

    </Step>
    <Step>
        
    ## Create a drop filter 

    Drop filters use NRQL queries to drop sensitive data. Here are three examples of a NRQL query using regex to locate and drop sensitive data:

        * EXAMPLE
        * EXAMPLE
        * EXAMPLE 

    There's a secion at the end of this procedure with regex samples to get you started with drop filters. 
    
    </Step>
    <Step>
        
    ## Add drop filter to four additional tables

        New Relic stores its data in five different tables. When you create a drop filter to drop one kind of data (say, a birth date), you need to repeat the process four additional times to account for those five tables. 

    </Step>
    <Step>
        
    ## Test your drop filter

    To test your drop filter, ELEPHANT 

    </Step>
</Steps>

## Sample expressions [#regex-ref]

REGEX INTRO HERE 

<CollapserGroup>
  <Collapser
    id="ssn"
    title="US social security number"
  >
    **Expression:**
    ```
    (\d{3}[-\s\.]?\d{2}[-\s\.]?\d{4})
    ```
  </Collapser>

  <Collapser
    id="ccn"
    title="Credit card number"
  >
    **Expression:**
    ```
    ((?:(?:4\d{3})|(?:5[1-5]\d{2})|6(?:011|5[0-9]{2}))(?:-?|\040?)(?:\d{4}(?:-?|\040?)){3}|(?:3[4,7]\d{2})(?:-?|\040?)\d{6}(?:-?|\040?)\d{5})
    ```
  </Collapser>

  <Collapser
    id="dob"
    title="US Date of birth"
  >
    **Expression:**
    ```
    ((?:\d{2})?\d\d(?:\\)?(?:\/)?\d\d(?:\\)?(?:\/)?\d{2}(?:\d{2})?)
    ```
  </Collapser>

  <Collapser
    id="email"
    title="Email address"
  >
    **Expression:**
    ```
    ([a-zA-Z0-9!#$'*+?^_`{|}~.-]+(?:@|%40)(?:[a-zA-Z0-9-]+\.)+[a-zA-Z0-9-]+)
    ```
  </Collapser>

  <Collapser
    id="ipv4"
    title="IP address (ipv4)"
  >
    **Expression:**
    ```
    ^([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$
    ```
  </Collapser>

  <Collapser
    id="usstreetaddress"
    title="US street address"
  >
    **Expression:**
    ```
    /\d{1,}(\s{1}\w{1,})(\s{1}?\w{1,})/g
    ```
  </Collapser>

  <Collapser
    id="usphone"
    title="US phone number"
  >
    **Expression:**
    ```
    (^[\+]?[1]?[\W]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4})
    ```
  </Collapser>

  <Collapser
    id="uspassport"
    title="US passport number"
  >
    **Expression:**
    ```
    ([a-zA-Z]?\d?\d{5,8})
    ```
  </Collapser>

  <Collapser
    id="uknino"
    title="UK national insurance number (NINO)"
  >
    **Expression:**
    ```
    ([a-zA-Z]{2}[-\s]?\d{2}[-\s]?\d{2}[-\s]?\d{2}[-\s]?[a-dA-D])
    ```
  </Collapser>

  <Collapser
    id="spainnid"
    title="Spain National ID (NIE/DNI/NIF)"
  >
    **Expression:**
    ```
    ([a-zA-Z]?[-\s]?\d{7,8}[-\s]?[a-zA-Z])
    ```
  </Collapser>

  <Collapser
    id="indiapanid"
    title="India PAN ID"
  >
    **Expression:**
    ```
    ^([a-zA-Z]){5}([0-9]){4}([a-zA-Z]){1}?$
    ```
  </Collapser>

  <Collapser
    id="indiaaadhaar"
    title="India AADHAAR ID"
  >
    **Expression:**
    ```
    ^([2-9]{1}[0-9]{3}\s\d{4}\s\d{4})$
    ```
  </Collapser>

  <Collapser
    id="caphin"
    title="Canada personal health/social insurance number (PHIN/SIN)"
  >
    **Expression:**
    ```
    (\d{3}[-\s\.]?\d{3}[-\s\.]?\d{3})
    ```
  </Collapser>

  <Collapser
    id="cahcn"
    title="Canada health card number"
  >
    **Expression:**
    ```
    (\d{10})
    ```
  </Collapser>

</CollapserGroup>

## What's next? [#whats-next]

