---
title: 'Remove sensitive data with drop filters'
metaDescription: 'Drop filters use regex to filter out personally identifying information before it reaches our databases.'
freshnessValidatedDate: never
---

import apmAimDropFilters from 'images/apm_screenshot-crop_aim-drop-filters.webp'

AI Monitoring captures event data about how your AI assistant responds to prompts. When an end user interacts with an AI assistant, prompts and responses are recorded as strings inside event attributes. You may find that some prompts or responses contain information you won't want stored in NRDB.   

With drop filters, you can apply regex to NRQL queries so AI Monitoring can match data to the query, then drop it if needed.

<img
    title="Drop filters page"
    alt="A screenshot that shows the drop filter landing page for AIM"
    src={apmAimDropFilters}
/>

<figcaption>
    Go to **[one.newrelic.com](https://one.newrelic.com) > All capabilities > AI Monitoring > Drop filters**
</figcaption>

## Build your drop filters [#sec-compliance]

Prompts and responses are stored as attributes under five separate event types:  

<table>

    <tbody>
        <tr>
            <td>
                `LlmChatCompletion`
            </td>
            <td>
                Describe what decisions / point of the toolchain this event captures as it relates to sensitive data
            </td>
        </tr>
        <tr>
            <td>
                `LlmTool`
            </td>
            <td>
                  Describe what decisions / point of the toolchain this event captures as it relates to sensitive data
            </td>
        </tr>
        <tr>
            <td>
                `LlmChain events`
            </td>
            <td>
                  Describe what decisions / point of the toolchain this event captures as it relates to sensitive data
            </td>
        </tr>
        <tr>
            <td>
                `LlmChatCompletionSummary`
            </td>
            <td>
                  Describe what decisions / point of the toolchain this event captures as it relates to sensitive data
            </td>
        </tr>
                <tr>
            <td>
                `LlmChatCompletionMessage`
            </td>
            <td>
                  Describe what decisions / point of the toolchain this event captures as it relates to sensitive data
            </td>
        </tr>
    </tbody>

</table>

Let's say that you want to drop any prompts or responses that reference account information, like a shipping address. Creating drop filters for this type of sensitive information requires four phases:

1. Identify the information you want to filter, then find the regex for it.
2. Take a NRQL query for an event type and apply regex to the query. 
3. Repeat step two for the four other event types, totaling five separate queries.
4. Repeat steps one through three for other kinds of information you want dropped. 

## Cautions: Drop rules and data compliance [#caution]

When creating drop rules, you're responsible for ensuring that the rules accurately identify and discard the data that meets the conditions you've established. You're also responsible for monitoring the rule, as well as the data you disclose to New Relic.

* New Relic can't guarantee that this functionality completely resolves your data disclosure concerns. 
* New Relic doesn't review or monitor how effective your drop rules are.

Keep in mind that creating rules about sensitive data can leak information about the kinds of data you maintain, including the format of your data or systems (for example, through referencing email addresses or specific credit card numbers). Any user with the relevant role-based access control permissions can view and edit all information in the rules you create.

## Create drop filters [#create]

The below procedures give you an example workflow for dropping information from all event types. 

<Steps>
    <Step>

    ## Go to the drop filters page [#filters-page]

        Go to **[one.newrelic.com > All Capabilities > AI Monitoring > Drop filters](https://onenr.io/0PoR8KlvYwG)**, then click **Create drop filter**. 

    </Step>
    <Step>
        
    ## Prepare your NRQL query [#nrql] 

      All drop rules build off the same NRQL query:

    ```sql
    SELECT content FROM <EVENT_TYPE_HERE> WHERE content RLIKE <YOUR_REGEX_HERE>
    ```

      Let's say you want to create a filter for a shipping address. Your first query would look like this:

  ```sql
      SELECT content FROM LlmChatCompletion WHERE content RLIKE r''.*/\d{1,}(\s{1}\w{1,})(\s{1}?\w{1,})/g
  ```
    
    </Step>
    <Step>
        
    ## Add drop filter to four additional events

      Since your first query used `LlmChatCompletion`, you need to update the `FROM` clause for the other events:

      * `LlmTool`
      * `LlmChain events`
      * `LlmChatCompletionSummary`
      * `LlmChatCompletionMessage`

    </Step>
    <Step>
        
    ## Repeat for other types of information.

    You've now dropped address information from all five event types. You can refer to the sample regex section to create more sets of drop rules for other information. 

    </Step>
</Steps>

## Sample expressions [#regex-ref]

We've provided some sample regex to help you create your drop rules. While not an exhaustive list, it covers some standard types of information you may want dropped.  

<CollapserGroup>
  <Collapser
    id="ssn"
    title="US social security number"
  >
    **Expression:**
    ```
    (\d{3}[-\s\.]?\d{2}[-\s\.]?\d{4})
    ```
  </Collapser>

  <Collapser
    id="ccn"
    title="Credit card number"
  >
    **Expression:**
    ```
    ((?:(?:4\d{3})|(?:5[1-5]\d{2})|6(?:011|5[0-9]{2}))(?:-?|\040?)(?:\d{4}(?:-?|\040?)){3}|(?:3[4,7]\d{2})(?:-?|\040?)\d{6}(?:-?|\040?)\d{5})
    ```
  </Collapser>

  <Collapser
    id="dob"
    title="US Date of birth"
  >
    **Expression:**
    ```
    ((?:\d{2})?\d\d(?:\\)?(?:\/)?\d\d(?:\\)?(?:\/)?\d{2}(?:\d{2})?)
    ```
  </Collapser>

  <Collapser
    id="email"
    title="Email address"
  >
    **Expression:**
    
    ```
    ([a-zA-Z0-9!#$'*+?^_`{|}~.-]+(?:@|%40)(?:[a-zA-Z0-9-]+\.)+[a-zA-Z0-9-]+)
    ```
  </Collapser>

  <Collapser
    id="ipv4"
    title="IP address (ipv4)"
  >
    **Expression:**
    ```
    ^([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$
    ```
  </Collapser>

  <Collapser
    id="usstreetaddress"
    title="US street address"
  >
    **Expression:**
    ```
    /\d{1,}(\s{1}\w{1,})(\s{1}?\w{1,})/g
    ```
  </Collapser>

  <Collapser
    id="usphone"
    title="US phone number"
  >
    **Expression:**
    ```
    (^[\+]?[1]?[\W]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4})
    ```
  </Collapser>

  <Collapser
    id="uspassport"
    title="US passport number"
  >
    **Expression:**
    ```
    ([a-zA-Z]?\d?\d{5,8})
    ```
  </Collapser>

  <Collapser
    id="uknino"
    title="UK national insurance number (NINO)"
  >
    **Expression:**
    ```
    ([a-zA-Z]{2}[-\s]?\d{2}[-\s]?\d{2}[-\s]?\d{2}[-\s]?[a-dA-D])
    ```
  </Collapser>

  <Collapser
    id="spainnid"
    title="Spain National ID (NIE/DNI/NIF)"
  >
    **Expression:**
    ```
    ([a-zA-Z]?[-\s]?\d{7,8}[-\s]?[a-zA-Z])
    ```
  </Collapser>

  <Collapser
    id="indiapanid"
    title="India PAN ID"
  >
    **Expression:**
    ```
    ^([a-zA-Z]){5}([0-9]){4}([a-zA-Z]){1}?$
    ```
  </Collapser>

  <Collapser
    id="indiaaadhaar"
    title="India AADHAAR ID"
  >
    **Expression:**
    ```
    ^([2-9]{1}[0-9]{3}\s\d{4}\s\d{4})$
    ```
  </Collapser>

  <Collapser
    id="caphin"
    title="Canada personal health/social insurance number (PHIN/SIN)"
  >
    **Expression:**
    ```
    (\d{3}[-\s\.]?\d{3}[-\s\.]?\d{3})
    ```
  </Collapser>

  <Collapser
    id="cahcn"
    title="Canada health card number"
  >
    **Expression:**
    ```
    (\d{10})
    ```
  </Collapser>

</CollapserGroup>

## What's next? [#whats-next]

Now that you've secured your customer data, you can explore other AI Monitoring features:

* Explore your [AI responses](/docs/ai-observability/view-ai-data/ai-response-performance) or [compare model performance](/docs/ai-observability/view-ai-data/compare-models) in New Relic.
* Update your app code to [correlate user feedback to AI responses](/docs/ai-observability/user-feedback).
* If you've enabled logging, [create drop rules for log messages](/docs/logs/ui-data/drop-data-drop-filter-rules).
