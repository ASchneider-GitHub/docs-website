---
componentType: default
optiontype: task
headingText: UPDATE
---

First, you need to link each of your AWS accounts with your New Relic account. To do so, use either of these options:

* Go to <DNT>**[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Infrastructure > AWS**</DNT>, click on <DNT>**Add an AWS account**</DNT>, then on <DNT>**Use metric streams**</DNT>, and follow the steps.
* [Automate this step with NerdGraph](/docs/apis/nerdgraph/examples/nerdgraph-cloud-integrations-api-tutorial/#link-aws-cloudwatch).

Next, set up the metric stream using the [CloudFormation template](https://console.aws.amazon.com/cloudformation/home?#/stacks/quickcreate?templateURL=https://nr-downloads-main.s3.amazonaws.com/cloud_integrations/aws/cloudformation/MetricStreams_CloudFormation.yml&stackName=NewRelic-Metric-Stream&param_NewRelicDatacenter=US) we provide in the last step of our UI. This template is provided as a base to set up the integration on a single region. You can customize and extend it to meet your requirements.

### CloudFormation Template Parameters

This table outlines the various parameters required for the CloudFormation template. Since the template will create new resources in your AWS account, we don't providing names of existing AWS resources here.

<table>
  <thead>
    <tr>
      <th style={{ width: '200px' }}>
        Name
      </th>

      <th>
        Description
      </th>

      <th>
        Constraints
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        New Relic Ingest License Key
      </td>

      <td>
        The <InlinePopover type="licenseKey"/> associated with the account you wish to export metrics to.
      </td>

      <td>
        40-character hexadecimal string
      </td>
    </tr>

    <tr>
      <td>
        New Relic Datacenter
      </td>

      <td>
        Identification of the New Relic data center your metrics are exported to. (EU data center accounts have license keys prefixed with `eu0x`)
      </td>

      <td>
        Allowed values: `US`, `EU`
      </td>
    </tr>

    <tr>
      <td>
        CloudWatch Metric Stream name
      </td>

      <td>
        Name of new CloudWatch Metric Stream (must be unique per AWS account in the same AWS Region)
      </td>

      <td>
        Must only container letters (uppercase and lowercase), numbers, and characters '\_', and '-' with max length of 255 total characters
      </td>
    </tr>

    <tr>
      <td>
        Kinesis Data Firehose name
      </td>

      <td>
        Name of new Kinesis Firehose Delivery Stream (must be unique per AWS account in the same AWS Region)
      </td>

      <td>
        Must only container letters (uppercase and lowercase), numbers, and characters '.', '\_', and '-' with max length of 64 total characters
      </td>
    </tr>

    <tr>
      <td>
        Firehose S3 backup bucket name
      </td>

      <td>
        Name of new S3 Bucket Destination for failed events (must be globally unique across all AWS accounts in all AWS Regions within a partition)
      </td>

      <td>
        Must adhere to the [S3 bucket naming rules](https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html)
      </td>
    </tr>

    <tr>
      <td>
        Enrich metrics with resource metadata from AWS Config
      </td>

      <td>
        Enable and configure AWS Config to track resource changes. This allows you a complete monitoring New Relic experience.
      </td>

      <td>
        Allowed values: `true`, `false`
      </td>
    </tr>

    <tr>
      <td>
        Config S3 backup bucket name
      </td>

      <td>
        Name of new S3 Bucket Destination for delivery channel configuration (must be globally unique across all AWS accounts in all AWS Regions within a partition)
      </td>

      <td>
        Must adhere to the [S3 bucket naming rules](https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html)
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  The provided CloudFormation template doesn't include any inclusion nor exclusion namespace filter in CloudWatch metric streams. Consider adapting the base template based on your business requirements.
</Callout>
