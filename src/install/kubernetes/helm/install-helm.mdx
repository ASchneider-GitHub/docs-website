---
componentType: default
headingText: Install the Kubernetes integration
---

New Relic has a bunch of Helm charts for the different components, each with its own set of features for the platform. You can install these components separately, but we really recommend using the [`nri-bundle`](https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle) chart. New Relic provides this chart, which acts as a wrapper or a meta-package for the individual charts.

To install `nri-bundle` with Helm follow these steps:

1. Make sure `kubectl` is installed and configured correctly to manage the cluster.

2. Use this command to add the New Relic Helm charts repo:
    ```shell
    helm repo add newrelic https://helm-charts.newrelic.com
    ```
3. Create a file named `values-newrelic.yaml`, which will be used to define your configuration:

    ```yaml
    global:
      licenseKey: _YOUR_NEW_RELIC_LICENSE_KEY_
      cluster: _K8S_CLUSTER_NAME_
    
    newrelic-prometheus-agent:
      # Automatically scrape prometheus metrics for annotated services in the cluster
      # Collecting prometheus metrics for large clusters might impact data usage significantly
      enabled: true
    nri-metadata-injection:
      # Deploy our webhook to link APM and Kubernetes entities
      enabled: true
    nri-kube-events:
      # Report Kubernetes events
      enabled: true
    newrelic-logging:
      # Report logs for containers running in the cluster
      enabled: true
    kube-state-metrics:
      # Deploy kube-state-metrics in the cluster.
      # Set this to true unless it is already deployed.
      enabled: true
    ```
4. Make sure everything is configured properly in the chart by running the following command. Notice that we're specifying `--dry-run` and `--debug`, so nothing will be installed in this step:

    ```shell
    helm upgrade --install newrelic-bundle newrelic/nri-bundle \
    --namespace newrelic --create-namespace \
    -f values-newrelic.yaml \
    --dry-run \
    --debug
    ```
    
    Please notice and adjust the following flags:
    
        * `global.licenseKey=YOUR_NEW_RELIC_LICENSE_KEY`: Must be set to a valid <InlinePopover type="licenseKey" /> for your account.
        * `global.cluster=K8S_CLUSTER_NAME`: It's used to identify the cluster in the New Relic UI, so should be a descriptive value not used by any other Kubernetes cluster configured in your New Relic account.
        * `kube-state-metrics.enabled=true`: Setting this to `true` will automatically install Kube State Metrics (KSM) for you, which is required for our integration to run. You can set this to false if KSM is already present in your cluster, even if it's on a different namespace.
        * `newrelic-prometheus-agent.enabled=true`: Will deploy our Prometheus Agent, which automatically collects data from Prometheus endpoints present in the cluster.
        * `nri-metadata-injection.enabled=true`: Will install our minimal webhook, which adds environment variables that, in turn, allows [linking applications instrumented with New Relic APM to Kubernetes](/docs/kubernetes-pixie/kubernetes-integration/link-your-applications/link-your-applications-kubernetes).

    Our Kubernetes charts have a comprehensive set of flags and tunables that can be edited to better fit your particular needs. Please, check the [Configure the integration](#configure) section below to see what can be changed.

5. Install the Kubernetes integration by running the command without `--debug` and `--dry-run`:

    ```shell
    helm upgrade --install newrelic-bundle newrelic/nri-bundle \
    --namespace newrelic --create-namespace \
    -f values-newrelic.yaml
    ```
    
6. Run this command to check that pods are deploying and reaching a stable state:

    ```shell
    kubectl -n newrelic get pods -w
    ```

7.  If you're going to use a GKE AutoPilot cluster, your Helm command should include the following:

    ```yaml
    --set newrelic-infrastructure.controlPlane.enabled=false \
    --set newrelic-infrastructure.kubelet.config.scheme=http \
    --set newrelic-infrastructure.kubelet.config.port=10255 \
    ```

    [Fluent Bit](https://fluentbit.io/) can use a FileStore volume to prevent data loss or duplicated logs during Fluent Bit pod restarts or redeploys.  Google FileStore API needs to be enabled in your GKE project. Check this [document](https://support.google.com/googleapi/answer/6158841) to know more about enabling APIs. 

    To use FileStore, add the following:

    ```yaml
    --set newrelic-logging.fluentBit.persistence.mode=persistentVolume
    --set newrelic-logging.fluentBit.persistence.persistentVolume.storageClass=standard-rwx
    ```

    <Callout variant="important">
    The use of FileStore will result in additional costs, as charged by Google. See your Google Cloud Admin or the [FileStore](https://cloud.google.com/filestore/pricing) doc for more info.
    </Callout>

    If you don't want to use FileStore, add the following:

    * Set `"newrelic-logging.fluentBit.persistence.mode"` to `"none"`
    * Remove `"newrelic-logging.fluentBit.persistence.persistentVolume.storageClass"`

8. Decide if you want to install and configure the Prometheus endpoints to scrape. See [Install and configure the Prometheus agent on Kubernetes clusters](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/install-prometheus-agent/) for more info. We recommend to scrape all Prometheus endpoints except core Kubernetes system metrics. Kubernetes integration already collects core Kubernetes system metrics in other components. 

9. Gather Log data. You can:

    * Forward all logs with full enrichment. Full enrichment ensures that all Kubernetes metadata, including labels and annotations, are associated with each log record. See [Fluent Bit](https://docs.fluentbit.io/manual/installation/kubernetes#concepts) documentation for more info.

    * Forward all logs with minimal enrichment (low data mode). See [New Relic Logging](/docs/kubernetes-pixie/kubernetes-integration/installation/reduce-ingest/#new-relic-logging) for more info.

    We recommend you forward all logs with minimal enrichment. This is a low-data mode that excludes labels excludes labels and annotations from log records, but keeps a minimal set of Kubernetes metadata. This set includes `cluster_name`, `container_name`, `namespace_name`, and `pod_name`.


You should see the following:

    * `newrelic-nrk8s-ksm` pod.
    * `newrelic-nrk8s-kubelet` pod for each node in your cluster.
    * `newrelic-nrk8s-control-plane` pod for each master node in your cluster, if any.
    * `newrelic-kube-state-metrics` pod, if you included KSM with our installation.
    * `newrelic-nri-kube-events` pod, if you enabled Kubernetes events reporting.
    * `prometheus-agent` pod, if you enabled the [Prometheus agent](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/install-prometheus-agent) integration.
    * `newrelic-newrelic-logging` pod for each node in your cluster, if you enabled the logging integration.

