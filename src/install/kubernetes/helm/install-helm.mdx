---
componentType: default
headingText: Install the Kubernetes integration
---


[Helm](https://helm.sh/) is a package manager on top of Kubernetes. It facilitates installation, upgrades, or revision tracking, and it manages dependencies for the services that you install in Kubernetes. You can manually install the Kubernetes integration using Helm from the `values.yaml` file.

New Relic provides various Helm charts for different components, each with unique features for the platform:

* [`newrelic-infrastructure`](https://github.com/newrelic/nri-kubernetes/tree/main/charts/newrelic-infrastructure): Contains the main Kubernetes integration and the infrastructure agent. This is the core component for the New Relic Kubernetes experience. It reports most of the data in the Kubernetes dashboard and the Kubernetes cluster explorer.
* [`newrelic-logging`](https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-logging): Provides a DaemonSet with New Relic's [Fluent Bit](https://fluentbit.io/) output [plugin](https://github.com/newrelic/newrelic-fluent-bit-output) to easily forward your logs to [New Relic](/docs/logs/get-started/get-started-log-management/).
* [`nri-kube-events`](https://github.com/newrelic/nri-kube-events/tree/main/charts/nri-kube-events): Collects and reports cluster events, such as `kubectl get events` to New Relic.
* [`newrelic-prometheus-agent`](https://github.com/newrelic/newrelic-prometheus-configurator/tree/main/charts/newrelic-prometheus-agent): New Relic's Prometheus configurator configures a [Prometheus in agent mode](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/install-prometheus-agent/) and use our remote write endpoint to [reports metrics to New Relic](/docs/infrastructure/prometheus-integrations/get-started/send-prometheus-metric-data-new-relic/#remote-write).
* [`nri-metadata-injection`](https://github.com/newrelic/k8s-metadata-injection/tree/main/charts/nri-metadata-injection): Sets up a minimal `MutatingAdmissionWebhook` that injects a couple of environment variables in the containers. These contain metadata about the cluster and New Relic installation and will be later picked up by applications instrumented using APM, allowing to [correlate APM and infrastructure data](/docs/kubernetes-pixie/kubernetes-integration/advanced-configuration/link-apm-applications-kubernetes/).
* [`nri-statsd`](https://github.com/newrelic/helm-charts/tree/master/charts/nri-statsd): New Relic StatsD integration.

Although you can install these components separately, we strongly recommend you use the [`nri-bundle`](https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle) chart. New Relic provides this chart, which acts as a wrapper or a meta-package for the individual charts mentioned above. The use of this chart enables you these advantages: 

    * It provides full control over which components are installed. Each component is installed as a separate [Helm dependency](https://helm.sh/docs/chart_template_guide/subcharts_and_globals/#overriding-values-from-a-parent-chart). You can configure them individually using the parameters mentioned [here](#configure).
    * It ensures that their installed versions are compatible with each other.
    * It ensures that their configuration values are consistent across the installed charts.


To manually install the Kubernetes integration using Helm follow these steps:

1. Enter your license key. You can create a new one or use an existing key.

2. Run this command to add a Kubernetes cluster name:
    
        ```shell
        ASK FOR THIS COMMAND

        --set global.cluster=clusterName
        kubectl config set-cluster
        ``` 

3. Run this command to add a namespace for the integration. The default namespace is `newrelic`:

        ```shell
        ASK FOR THIS COMMAND

        helm repo add newrelic https://helm-charts.newrelic.com
        helm repo update
        kubectl create namespace newrelic
        ```

4. If you're using a GKE AutoPilot cluster, run this command:

        ```shell
            ASK FOR THIS COMMAND
        ```

        Keep in mind that if you use a GKE AutoPilot cluster, these parameters will change:

        * Privileged, ControlPlane, and Pixie set to `false`.
        * Kubelet scheme set to `HTTP`.
        * Kubelet port to `10255`.

5. Install Prometheus Agent to collect metrics from the Prometheus endpoints exposed in the cluster. We recommend you scrape Prometheus data.   

6. Forward all logs with minimal enrichment. This is a low-data mode that excludes labels excludes labels and annotations from log records, but keeps a minimal set of Kubernetes metadata. This set includes `cluster_name`, `container_name`, `namespace_name`, and `pod_name`.

7. If you want to use a Google FileStore volume to keep track of forwarded logs, run this command:

    ```shell
        ASK FOR THIS COMMAND
    ```

8. If you want to use a proxy, run this command:

    ```
    ASK FOR THIS COMMAND

    HTTPS_PROXY=https://my-proxy:3128
    ```
9. Test your connection and see your data.


### Installing `nri-bundle` with Helm

1. Ensure you're using the appropriate context in the machine where you will run Helm and `kubectl`. Use this command to check the available contexts:
    ```shell
        kubectl config get-contexts
    ```
    Use this command to switch to the desired context:
    
    ```shell
    kubectl config use-context _CONTEXT_NAME_
    ```
2. Use this command to add the New Relic Helm charts repo:
    ```shell
    helm repo add newrelic https://helm-charts.newrelic.com
    ```
3. Create a file named `values-newrelic.yaml`, which will be used to define your configuration:

    ```yaml
    global:
      licenseKey: _YOUR_NEW_RELIC_LICENSE_KEY_
      cluster: _K8S_CLUSTER_NAME_
    
    newrelic-prometheus-agent:
      # Automatically scrape prometheus metrics for annotated services in the cluster
      # Collecting prometheus metrics for large clusters might impact data usage significantly
      enabled: true
    nri-metadata-injection:
      # Deploy our webhook to link APM and Kubernetes entities
      enabled: true
    nri-kube-events:
      # Report Kubernetes events
      enabled: true
    newrelic-logging:
      # Report logs for containers running in the cluster
      enabled: true
    kube-state-metrics:
      # Deploy kube-state-metrics in the cluster.
      # Set this to true unless it is already deployed.
      enabled: true
    ```
4. Make sure everything is configured properly in the chart by running the following command. Notice that we're specifying `--dry-run` and `--debug`, so nothing will be installed in this step:

    ```shell
    helm upgrade --install newrelic-bundle newrelic/nri-bundle \
    --namespace newrelic --create-namespace \
    -f values-newrelic.yaml \
    --dry-run \
    --debug
    ```
    
    Please notice and adjust the following flags:
    
        * `global.licenseKey=YOUR_NEW_RELIC_LICENSE_KEY`: Must be set to a valid <InlinePopover type="licenseKey" /> for your account.
        * `global.cluster=K8S_CLUSTER_NAME`: It's used to identify the cluster in the New Relic UI, so should be a descriptive value not used by any other Kubernetes cluster configured in your New Relic account.
        * `kube-state-metrics.enabled=true`: Setting this to `true` will automatically install Kube State Metrics (KSM) for you, which is required for our integration to run. You can set this to false if KSM is already present in your cluster, even if it's on a different namespace.
        * `newrelic-prometheus-agent.enabled=true`: Will deploy our Prometheus Agent, which automatically collects data from Prometheus endpoints present in the cluster.
        * `nri-metadata-injection.enabled=true`: Will install our minimal webhook, which adds environment variables that, in turn, allows [linking applications instrumented with New Relic APM to Kubernetes](/docs/kubernetes-pixie/kubernetes-integration/link-your-applications/link-your-applications-kubernetes).

    Our Kubernetes charts have a comprehensive set of flags and tunables that can be edited to better fit your particular needs. Please, check the [Configure the integration](#configure) section below to see what can be changed.

5. Install the Kubernetes integration by running the command without `--debug` and `--dry-run`:

    ```shell
    helm upgrade --install newrelic-bundle newrelic/nri-bundle \
    --namespace newrelic --create-namespace \
    -f values-newrelic.yaml
    ```
    
    <Callout variant="important">
    Make sure you're using Kubernetes version 1.27.x or [a lower version that we support](/docs/kubernetes-pixie/kubernetes-integration/get-started/kubernetes-integration-compatibility-requirements).
    </Callout>

6. Run this command to check that pods are deploying and reaching a stable state:

    ```shell
    kubectl -n newrelic get pods -w
    ```

You should see the following:

    * `newrelic-nrk8s-ksm` pod.
    * `newrelic-nrk8s-kubelet` pod for each node in your cluster.
    * `newrelic-nrk8s-control-plane` pod for each master node in your cluster, if any.
    * `newrelic-kube-state-metrics` pod, if you included KSM with our installation.
    * `newrelic-nri-kube-events` pod, if you enabled Kubernetes events reporting.
    * `prometheus-agent` pod, if you enabled the [Prometheus agent](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/install-prometheus-agent) integration.
    * `newrelic-newrelic-logging` pod for each node in your cluster, if you enabled the logging integration.

