---
componentType: default
headingText: Configure the Ruby agent
freshnessValidatedDate: never
---

To collect AI data, you need to set certain configurations to enable AI monitoring. We recommend applying these configurations in `newrelic.yml`, but if you have a more complex set up with multiple environments, you can configure with environment variables.

<CollapserGroup>
    <Collapser
        id="config-file"
        title="Configure through `newrelic.yml`"
    >

        ```yml
        ai_monitoring.enabled: true
        instrumentation.ruby_openai: auto
        span_events.max_samples_stored: 10000
        custom_insights_events.max_samples_stored: 100000
        ```

    </Collapser>
    <Collapser
        id="environment-variables"
        title="Configure with environment variables"
    >

        ```bash
        NEW_RELIC_AI_MONITORING_ENABLED = TRUE
        ```

        ```bash
        NEW_RELIC_INSTRUMENTATION_RUBY_OPENAI = AUTO
        ```

        ```bash
        NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED = 10000
        ```

        ```bash
        NEW_RELIC_CUSTOM_INSIGHTS_EVENTS_MAX_SAMPLES_STORED = 100000      
        ```

    </Collapser>
</CollapserGroup>

* When you disable distributed tracing or enable high security mode, the agent will not capture AI data. 
* You can refer to the [Ruby configuration doc](/docs/apm/agents/ruby-agent/configuration/ruby-agent-configuration/#ai-monitoring) to learn more about AI monitoring configurations.
        * Refer to the [span events section](/docs/apm/agents/ruby-agent/configuration/ruby-agent-configuration/#custom_insights_events-max_samples_stored) for `span_events.max_samples_stored`
        * Refer to the [custom events section](/docs/apm/agents/ruby-agent/configuration/ruby-agent-configuration/#span_events-max_samples_stored)  for `custom_insights_events.max_samples_stored`
