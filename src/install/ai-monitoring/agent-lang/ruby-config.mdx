---
componentType: default
headingText: Configure the Ruby agent
freshnessValidatedDate: never
---

To collect AI data, you need to ensure that certain configurations are enabled when you instrument your AI-powered app. We also recommend updating other variables to improve data retention.

* We recommend applying these configurations in `newrelic.yml`. 
* If you have a more complex set up with multiple environments, you can configure with environment variables.

1. Set these variables:

    <table>
        <thead>
            <tr>
                <th>
                    Configuration file
                </th>
                <th>
                    Environment variable
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    `ai_monitoring.enabled = true`
                </td>
                <td>
                    `NEW_RELIC_AI_MONITORING_ENABLED = TRUE`
                </td>
            </tr>
            <tr>
                <td>
                    `instrumentation.ruby_openai = auto`
                </td>
                <td>
                    `NEW_RELIC_INSTRUMENTATION_RUBY_OPENAI = AUTO`
                </td>
            </tr>
            <tr>
                <td>
                    `distributed_tracing.enabled = true`
                </td>
                <td>
                    `NEW_RELIC_DISTRIBUTED_TRACING_ENABLED = TRUE`
                </td>
            </tr>
            <tr>
                <td>
                    `high_security = false`
                </td>
                <td>
                    `NEW_RELIC_HIGH_SECURITY = FALSE`

                </td>
            </tr>
        </tbody>
    </table>

    When you install an agent, `distributed_tracing.enabled` and `high_security` are set to the correct variables by default. When you disable distributed tracing or enable high security mode, the agent will not capture AI data. 

2. **(Recommended)** Update these configurations: 

    <table>
        <thead>
            <tr>
                <th>
                    Configuration
                </th>
                <th>
                    Environment variable
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    `span_events.max_samples_stored = 10000`
                </td>
                <td>
                    `NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED = 10000`

                </td>
            </tr>
            <tr>
                <td>
                    `custom_insights_events.max_samples_stored = 100000`
                </td>
                <td>
                    `NEW_RELIC_CUSTOM_INSIGHTS_EVENTS_MAX_SAMPLES_STORED = 100000`
                </td>
            </tr>
            <tr>
            <td>
                `ai_monitoring.streaming.enabled = true`
            </td>
            <td>
                `NEW_RELIC_AI_MONITORING_STREAMING_ENABLED = TRUE`
            </td>
            </tr>
            <tr>
            <td>
                `ai_monitoring.record_content.enabled = true`
            </td>
            <td>
                `NEW_RELIC_AI_MONITORING_RECORD_CONTENT_ENABLED = TRUE`
            </td>
            </tr>
        </tbody>
    </table>